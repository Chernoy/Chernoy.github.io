<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>blog | Chernoy’s blog</title><meta name="author" content="Chernoy"><meta name="copyright" content="Chernoy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="springboot+vue搭建博客">
<meta property="og:type" content="article">
<meta property="og:title" content="blog">
<meta property="og:url" content="https://chernoy.github.io/2023/05/29/blog/index.html">
<meta property="og:site_name" content="Chernoy’s blog">
<meta property="og:description" content="springboot+vue搭建博客">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.peo.pw/a/2023/05/03/64520e0de0db4.jpg">
<meta property="article:published_time" content="2023-05-29T10:15:35.000Z">
<meta property="article:modified_time" content="2023-06-26T13:22:32.599Z">
<meta property="article:author" content="Chernoy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.peo.pw/a/2023/05/03/64520e0de0db4.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://chernoy.github.io/2023/05/29/blog/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: ,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'blog',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-26 21:22:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/font.css"><script src="/js/sakura.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}

preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic.peo.pw/a/2023/05/29/647490a877680.jpg" onerror="onerror=null;src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/hot-article/"><i class="fa-fw fa-solid fa-book-bookmark"></i><span> 阅读排行</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-pencil"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 友链</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-circle-user"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-heart"></i><span> 关于&amp;留言</span></a></li><li><a class="site-page child" href="/sharesomething/"><i class="fa-fw fa-solid fa-walkie-talkie"></i><span> 生活点滴</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw fa-solid fa-walkie-talkie"></i><span> 碎碎念念</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.peo.pw/a/2023/05/03/64520e0de0db4.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Chernoy’s blog"><img class="site-icon" src="https://pic.peo.pw/a/2023/05/29/647490a877680.jpg"/><span class="site-name">Chernoy’s blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/hot-article/"><i class="fa-fw fa-solid fa-book-bookmark"></i><span> 阅读排行</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-pencil"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 友链</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-circle-user"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-heart"></i><span> 关于&amp;留言</span></a></li><li><a class="site-page child" href="/sharesomething/"><i class="fa-fw fa-solid fa-walkie-talkie"></i><span> 生活点滴</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw fa-solid fa-walkie-talkie"></i><span> 碎碎念念</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">blog</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-29T10:15:35.000Z" title="发表于 2023-05-29 18:15:35">2023-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-26T13:22:32.599Z" title="更新于 2023-06-26 21:22:32">2023-06-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">30.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>143分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="blog"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="项目实战-前后端分离博客系统"><a href="#项目实战-前后端分离博客系统" class="headerlink" title="项目实战-前后端分离博客系统"></a>项目实战-前后端分离博客系统</h1><h2 id="1-课程介绍"><a href="#1-课程介绍" class="headerlink" title="1.课程介绍"></a>1.课程介绍</h2><ul>
<li>纯后端讲解</li>
<li>完整的前台后台代码编写</li>
<li>主流技术栈（SpringBoot,MybatisPlus,SpringSecurity,EasyExcel,Swagger2,Redis,Echarts,Vue,ElementUI….）</li>
<li>完善细致的需求分析</li>
<li>由易到难循序渐进</li>
</ul>
<h2 id="2-创建工程"><a href="#2-创建工程" class="headerlink" title="2.创建工程"></a>2.创建工程</h2><p>​	我们有前台和后台两套系统。两套系统的前端工程都已经提供好了。所以我们只需要写两套系统的后端。</p>
<p>​	但是大家思考下，实际上两套后端系统的很多内容是可能重复的。这里如果我们只是单纯的创建两个后端工程。那么就会有大量的重复代码，并且需要修改的时候也需要修改两次。这就是代码复用性不高。</p>
<p>​	所以我们需要创建多模块项目，两套系统可能都会用到的代码可以写到一个公共模块中，让前台系统和后台系统分别取依赖公共模块。</p>
<p><strong>思考：</strong></p>
<p>分模块开发，导入依赖的时候，子模块依赖于父模块（maven高级）自动聚合，<dependencymanagement></dependencymanagement>标签作用？目前知道的就是版本锁定，子模块中导入依赖无需再添加版本，以免造成依赖冲突。</p>
<p>① 创建父模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SGBlog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>sangeng-framework<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>sangeng-admin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>sangeng-blog<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot的依赖配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--fastjson依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jwt依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatisPlus依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--阿里云OSS--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>$&#123;project.build.sourceEncoding&#125;<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>②创建公共子模块 sangeng-framework</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SGBlog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sangeng-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombk--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringSecurity启动器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--redis依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--fastjson依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jwt依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatisPlus依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql数据库驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--阿里云OSS--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--AOP--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>③创建博客后台模块sangeng-admin</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SGBlog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sangeng-admin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sangeng-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>④创建博客前台模块sangeng-blog</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SGBlog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sangeng-blog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sangeng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sangeng-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-博客前台"><a href="#3-博客前台" class="headerlink" title="3.博客前台"></a>3.博客前台</h2><h3 id="3-0-准备工作"><a href="#3-0-准备工作" class="headerlink" title="3.0 准备工作"></a>3.0 准备工作</h3><h4 id="3-1-SpringBoot和MybatisPuls整合配置测试"><a href="#3-1-SpringBoot和MybatisPuls整合配置测试" class="headerlink" title="3.1 SpringBoot和MybatisPuls整合配置测试"></a>3.1 SpringBoot和MybatisPuls整合配置测试</h4><p>①创建启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 三更  B站： https://space.bilibili.com/663528522</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.sangeng.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SanGengBlogApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SanGengBlogApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②创建application.yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7777</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/sg_blog?characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">2MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">5MB</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">delFlag</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>③ SQL语句</p>
<p>​	SQL脚本：SGBlog\资源\SQL\sg_article.sql</p>
<p>④ 创建实体类，Mapper，Service </p>
<p>​	注意思考这些文件应该写在哪个模块下？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Article</span>  &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章类型:1 文章 2草稿</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//评论数</span></span><br><span class="line">    <span class="keyword">private</span> Integer commentCount;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Article&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Article&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考：</strong>实体类，mapper，service在两个系统中可以重复，共用</p>
<p>⑤ 创建Controller测试接口</p>
<p>​	注意思考这些文件应该写在哪个模块下？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.list();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考：</strong>放在blog前台目录下</p>
<p>​	我们可以暂时先注释掉sangeng-framework中的SpringSecurity依赖方便测试</p>
<h3 id="3-1-热门文章列表"><a href="#3-1-热门文章列表" class="headerlink" title="3.1 热门文章列表"></a>3.1 热门文章列表</h3><h4 id="3-1-0-文章表分析"><a href="#3-1-0-文章表分析" class="headerlink" title="3.1.0 文章表分析"></a>3.1.0 文章表分析</h4><p>​	通过需求去分析需要有哪些字段。</p>
<h4 id="3-1-1-需求"><a href="#3-1-1-需求" class="headerlink" title="3.1.1 需求"></a>3.1.1 需求</h4><p>​	需要查询浏览量最高的前10篇文章（分页查询）的信息。要求展示文章标题和浏览量（封装VO）。把能让用户自己点击跳转到具体的文章详情进行浏览。</p>
<p>​	注意：不能把草稿展示出来，不能把删除了的文章查询出来。要按	照浏览量进行降序排序。（三个查询条件）</p>
<p><img src="/2023/05/29/blog/image-20230605104046258.png" alt="image-20230605104046258"></p>
<h4 id="3-1-2-接口设计"><a href="#3-1-2-接口设计" class="headerlink" title="3.1.2 接口设计"></a>3.1.2 接口设计</h4><p>​	见接口文档</p>
<h4 id="3-1-3-基础版本代码实现"><a href="#3-1-3-基础版本代码实现" class="headerlink" title="3.1.3 基础版本代码实现"></a>3.1.3 基础版本代码实现</h4><p>①准备工作</p>
<p>统一响应类和响应枚举</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.enums.AppHttpCodeEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseResult</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResponseResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = AppHttpCodeEnum.SUCCESS.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = AppHttpCodeEnum.SUCCESS.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResponseResult</span><span class="params">(Integer code, T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResponseResult</span><span class="params">(Integer code, String msg, T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResponseResult</span><span class="params">(Integer code, String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">errorResult</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>();</span><br><span class="line">        <span class="keyword">return</span> result.error(code, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">okResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">okResult</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>();</span><br><span class="line">        <span class="keyword">return</span> result.ok(code, <span class="literal">null</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">okResult</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> setAppHttpCodeEnum(AppHttpCodeEnum.SUCCESS, AppHttpCodeEnum.SUCCESS.getMsg());</span><br><span class="line">        <span class="keyword">if</span>(data!=<span class="literal">null</span>) &#123;</span><br><span class="line">            result.setData(data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">errorResult</span><span class="params">(AppHttpCodeEnum enums)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> setAppHttpCodeEnum(enums,enums.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">errorResult</span><span class="params">(AppHttpCodeEnum enums, String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> setAppHttpCodeEnum(enums,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">setAppHttpCodeEnum</span><span class="params">(AppHttpCodeEnum enums)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> okResult(enums.getCode(),enums.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ResponseResult <span class="title function_">setAppHttpCodeEnum</span><span class="params">(AppHttpCodeEnum enums, String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> okResult(enums.getCode(),msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;?&gt; error(Integer code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(T data) &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AppHttpCodeEnum</span> &#123;</span><br><span class="line">    <span class="comment">// 成功</span></span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    NEED_LOGIN(<span class="number">401</span>,<span class="string">&quot;需要登录后操作&quot;</span>),</span><br><span class="line">    NO_OPERATOR_AUTH(<span class="number">403</span>,<span class="string">&quot;无权限操作&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">500</span>,<span class="string">&quot;出现错误&quot;</span>),</span><br><span class="line">    USERNAME_EXIST(<span class="number">501</span>,<span class="string">&quot;用户名已存在&quot;</span>),</span><br><span class="line">     PHONENUMBER_EXIST(<span class="number">502</span>,<span class="string">&quot;手机号已存在&quot;</span>), EMAIL_EXIST(<span class="number">503</span>, <span class="string">&quot;邮箱已存在&quot;</span>),</span><br><span class="line">    REQUIRE_USERNAME(<span class="number">504</span>, <span class="string">&quot;必需填写用户名&quot;</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="number">505</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    String msg;</span><br><span class="line"></span><br><span class="line">    AppHttpCodeEnum(<span class="type">int</span> code, String errorMessage)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = errorMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>② 代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hotArticleList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span>  articleService.hotArticleList();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Article&gt; &#123;</span><br><span class="line">    ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询热门文章 封装成ResponseResult返回</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//必须是正式文章</span></span><br><span class="line">        queryWrapper.eq(Article::getStatus,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//按照浏览量进行排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line">        <span class="comment">//最多只查询10条</span></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articles);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跨越解析：跨域请求是指浏览器从一个源（协议 + 域名 + 端口）向另一个源发起请求的行为。出于安全考虑，浏览器禁止跨域请求的默认行为，这时候就需要在后端进行跨域访问的配置。</p>
<p>③ 解决跨域问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">      <span class="comment">// 设置允许跨域的路径</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许跨域请求的域名</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 是否允许cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 设置允许的请求方式</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许的header属性</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 跨域允许时间</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-4-使用VO优化"><a href="#3-1-4-使用VO优化" class="headerlink" title="3.1.4 使用VO优化"></a>3.1.4 使用VO优化</h4><p>​	目前我们的响应格式其实是不符合接口文档的标准的，多返回了很多字段。这是因为我们查询出来的结果是Article来封装的，Article中字段比较多。</p>
<p>​	我们在项目中一般最后还要把VO来接受查询出来的结果。一个接口对应一个VO，这样即使接口响应字段要修改也只要改VO即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotArticleVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询热门文章 封装成ResponseResult返回</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//必须是正式文章</span></span><br><span class="line">        queryWrapper.eq(Article::getStatus,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//按照浏览量进行排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line">        <span class="comment">//最多只查询10条</span></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        <span class="comment">//bean拷贝</span></span><br><span class="line">        List&lt;HotArticleVo&gt; articleVos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Article article : articles) &#123;</span><br><span class="line">            <span class="type">HotArticleVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotArticleVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(article,vo);</span><br><span class="line">            articleVos.add(vo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articleVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-5-字面值处理"><a href="#3-1-5-字面值处理" class="headerlink" title="3.1.5 字面值处理"></a>3.1.5 字面值处理</h4><p>​	实际项目中都不允许直接在代码中使用字面值。都需要定义成常量来使用。这种方式有利于提高代码的可维护性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemConstants</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是草稿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_DRAFT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是正常分布状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_NORMAL</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询热门文章 封装成ResponseResult返回</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//必须是正式文章</span></span><br><span class="line">        queryWrapper.eq(Article::getStatus, SystemConstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line">        <span class="comment">//按照浏览量进行排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line">        <span class="comment">//最多只查询10条</span></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        <span class="comment">//bean拷贝</span></span><br><span class="line">        List&lt;HotArticleVo&gt; articleVos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Article article : articles) &#123;</span><br><span class="line">            <span class="type">HotArticleVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotArticleVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(article,vo);</span><br><span class="line">            articleVos.add(vo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articleVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-2-Bean拷贝工具类封装"><a href="#3-2-Bean拷贝工具类封装" class="headerlink" title="3.2 Bean拷贝工具类封装"></a>3.2 Bean拷贝工具类封装</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanCopyUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanCopyUtils</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V&gt; V <span class="title function_">copyBean</span><span class="params">(Object source,Class&lt;V&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="comment">//创建目标对象</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = clazz.newInstance();</span><br><span class="line">            <span class="comment">//实现属性copy</span></span><br><span class="line">            BeanUtils.copyProperties(source, result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;O,V&gt; List&lt;V&gt; <span class="title function_">copyBeanList</span><span class="params">(List&lt;O&gt; list,Class&lt;V&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.stream()</span><br><span class="line">                .map(o -&gt; copyBean(o,clazz))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码的理解：</p>
<p>这段代码实现了Java中对象属性的复制功能。其中，反射（reflection）是一种<strong>动态获取</strong>类信息并在运行时调用其方法&#x2F;构造函数的机制；泛型（generic）则是一种将<strong>类型参数</strong>化以提高程序的重用性和安全性的机制。</p>
<p>具体而言，该工具类包含两个静态方法：</p>
<ol>
<li><p><code>copyBean(Object source, Class&lt;V&gt; clazz)</code>：将一个源对象（source）中的属性值复制到目标类（clazz）的对象中，并返回目标对象。此处使用了<code>Class.newInstance()</code>来创建目标对象实例，并使用<code>BeanUtils.copyProperties(source, result)</code>来拷贝属性值。</p>
<p>方法内部自己创建vo对象，通过传入的参数来创建，所以用字节码反射方式创建目标对象来实现拷贝。</p>
<p>传入hotArticleVo，返回值类型就是hotArticleVo，（定义泛型）</p>
</li>
<li><p><code>copyBeanList(List&lt;O&gt; list,Class&lt;V&gt; clazz)</code>：将一个源对象列表（list）中的所有对象属性值复制到目标类（clazz）的对象列表中，并返回目标列表。此处使用了Java 8中的Stream API，对源列表进行遍历，并使用<code>map(o -&gt; copyBean(o, clazz))</code>将每个源对象转换为目标对象，最后使用<code>Collectors.toList()</code>将所有目标对象收集成列表。</p>
<p>先转换成流，然后进行流当中元素的转换（调用copyBean方法遍历，参数是查到的的对象和目标返回值）</p>
</li>
</ol>
<p>总之，通过反射和泛型技术，该工具类实现了方便快捷的Java对象属性复制功能。</p>
<h3 id="3-2查询分类列表"><a href="#3-2查询分类列表" class="headerlink" title="3.2查询分类列表"></a>3.2查询分类列表</h3><h4 id="3-2-0分类表分析"><a href="#3-2-0分类表分析" class="headerlink" title="3.2.0分类表分析"></a>3.2.0分类表分析</h4><p><img src="/2023/05/29/blog/image-20230605093336451.png" alt="image-20230605093336451"></p>
<h4 id="3-2-1需求"><a href="#3-2-1需求" class="headerlink" title="3.2.1需求"></a>3.2.1需求</h4><p><img src="/2023/05/29/blog/image-20230605093352542.png" alt="image-20230605093352542"></p>
<p>页面上展示分类列表，用户可以点击具体的分类查看该分类下的文章列表</p>
<p>注意：1.只展示发布正式文章的分类2.分类的状态必须是正常</p>
<h4 id="3-2-2接口设计"><a href="#3-2-2接口设计" class="headerlink" title="3.2.2接口设计"></a>3.2.2接口设计</h4><p>看idea吧，还没有接口文档</p>
<h4 id="3-2-3代码实现"><a href="#3-2-3代码实现" class="headerlink" title="3.2.3代码实现"></a>3.2.3代码实现</h4><p>entity：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分类表(Category)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-05-30 18:34:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span>  &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分类名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//父分类id，如果没有父分类为-1</span></span><br><span class="line">    <span class="keyword">private</span> Long pid;</span><br><span class="line">    <span class="comment">//描述</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//状态0:正常,1禁用</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryVo</span> &#123;</span><br><span class="line">    <span class="comment">//这里需要id 是因为 之后点击某个分类名称之后的跳转，需要getById</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分类表(Category)表数据库访问层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-05-30 18:34:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Category&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分类表(Category)表服务接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-05-30 18:34:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line"></span><br><span class="line">    ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分类表(Category)表服务实现类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-05-30 18:34:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//去article表里查已发布的文章  这里是第一个注意点，需要确保分类下的文章状态是正常</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lqw.eq(Article::getStatus, ARTICLE_STATUS_NORMAL);</span><br><span class="line">        List&lt;Article&gt; articleList = articleService.list(lqw);</span><br><span class="line">        <span class="comment">// 然后拿到分类id，去重</span></span><br><span class="line">        List&lt;Long&gt; categoryIdList = articleList.stream()</span><br><span class="line">                .map(article -&gt; article.getCategoryId())</span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//拿着这个有分类id的集合，去category表里查对应的分类</span></span><br><span class="line">        List&lt;Category&gt; categoryList = listByIds(categoryIdList);</span><br><span class="line">        <span class="comment">//这里是第二个注意点，要确保分类本身的状态也是正常</span></span><br><span class="line">        List&lt;Category&gt; categories = categoryList.stream()</span><br><span class="line">                .filter(category -&gt; category.getStatus().equals(SystemConstants.STATUS_NORMAL))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//封装成vo</span></span><br><span class="line">        List&lt;CategoryVo&gt; categoryVos = BeanCopyUtils.copyBeanList(categories, CategoryVo.class);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(categoryVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getCategoryList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> categoryService.getCategoryList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3分页查询文章列表和详情查询"><a href="#3-3分页查询文章列表和详情查询" class="headerlink" title="3.3分页查询文章列表和详情查询"></a>3.3分页查询文章列表和详情查询</h3><h4 id="3-3-1文章表分析"><a href="#3-3-1文章表分析" class="headerlink" title="3.3.1文章表分析"></a>3.3.1文章表分析</h4><p><img src="/2023/05/29/blog/image-20230605100603262.png" alt="image-20230605100603262"></p>
<h4 id="3-3-2需求"><a href="#3-3-2需求" class="headerlink" title="3.3.2需求"></a>3.3.2需求</h4><p>​     在首页和分类页面都需要查询文章列表。</p>
<p>​     首页：查询所有的文章</p>
<p>​     分类页面：查询对应分类下的文章</p>
<p>​    要求：1.只能查询正式发布的文章，2.置顶的文章要先是在最前面 </p>
<p>   点击展开查看文章详情</p>
<p>首页：返回的是ArticleListVo</p>
<p><img src="/2023/05/29/blog/image-20230605104119886.png" alt="image-20230605104119886"></p>
<p>分类：</p>
<p><img src="/2023/05/29/blog/image-20230605104250085.png" alt="image-20230605104250085"></p>
<p>详情：</p>
<p><img src="/2023/05/29/blog/image-20230605104332738.png" alt="image-20230605104332738"></p>
<h4 id="3-3-3接口设计"><a href="#3-3-3接口设计" class="headerlink" title="3.3.3接口设计"></a>3.3.3接口设计</h4><p>  见controller类</p>
<h4 id="3-3-4代码实现"><a href="#3-3-4代码实现" class="headerlink" title="3.3.4代码实现"></a>3.3.4代码实现</h4><p>MP分页插件的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.4.0之后版本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Integer pageNum, Integer pageSize, Long categoryId)</span> &#123;</span><br><span class="line">        <span class="comment">//这里是可以给分类 那里调用查询文章，也可以给首页调用查询文章，这俩区别就在一首页不需要传入分类id全部展示</span></span><br><span class="line">        <span class="comment">//分类页面需要传入分类id展示id对应下的文章</span></span><br><span class="line">        <span class="comment">//查询条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; lqw=<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//如果传categoryId就要求 查询和传入的要相同</span></span><br><span class="line">        <span class="comment">//复用就体现在这里，如果进入的是首页，没有分类id那接下来的查询中，就不会带有这个条件，</span></span><br><span class="line">        lqw.eq(Objects.nonNull(categoryId)&amp;&amp;categoryId&gt;<span class="number">0</span>,Article::getCategoryId,categoryId);</span><br><span class="line">        <span class="comment">//状态正式发布的</span></span><br><span class="line">        lqw.eq(Article::getStatus, ARTICLE_STATUS_NORMAL);</span><br><span class="line">        <span class="comment">//置顶排序</span></span><br><span class="line">        lqw.orderByDesc(Article::getIsTop);</span><br><span class="line">        <span class="comment">//分页查询</span></span><br><span class="line">        Page&lt;Article&gt; pageInfo =<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page(pageInfo,lqw);</span><br><span class="line">        List&lt;Article&gt; articles = pageInfo.getRecords();</span><br><span class="line">        <span class="comment">//查询categoryName</span></span><br><span class="line">        <span class="comment">//这里的分类id，是从article实体对象里拿的不是传入的，拿到id查询name，这一步无论首页还是分类也都有</span></span><br><span class="line">        articles.stream()</span><br><span class="line">                .map(article -&gt;article.setCategoryName(categoryService.getById(article.getCategoryId()).getName()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"><span class="comment">//        articleId去查询articleName进行设置</span></span><br><span class="line"><span class="comment">//        for (Article article : articles) &#123;</span></span><br><span class="line"><span class="comment">//            Category category = categoryService.getById(article.getCategoryId());</span></span><br><span class="line"><span class="comment">//            article.setCategoryName(category.getName());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装查询结果   拷贝根据类型和字段名进行匹配</span></span><br><span class="line">        List&lt;ArticleListVo&gt; articleListVos = BeanCopyUtils.copyBeanList(articles, ArticleListVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(articleListVos,pageInfo.getTotal());</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//根据ID查询文章</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line">        <span class="comment">//根据分类id查分类名称</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> articleDetailVo.getCategoryId();</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span>(category!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> category.getName();</span><br><span class="line">            articleDetailVo.setCategoryName(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//封装响应返回</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章的分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageNum</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/articleList&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Integer pageNum,Integer pageSize,Long categoryId)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> articleService.articleList(pageNum,pageSize,categoryId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> articleService.getArticleDetail(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vo：</p>
<p>PageVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List rows;</span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArticleListVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleListVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类名称</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArticleDetailVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleDetailVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//所属分类名称</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-5FastJson"><a href="#3-3-5FastJson" class="headerlink" title="3.3.5FastJson"></a>3.3.5FastJson</h4><p>日期显示问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span><span class="comment">//使用@Bean注入fastJsonHttpMessageConvert</span></span><br><span class="line"><span class="keyword">public</span> HttpMessageConverter <span class="title function_">fastJsonHttpMessageConverters</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1.需要定义一个Convert转换消息的对象</span></span><br><span class="line">    <span class="type">FastJsonHttpMessageConverter</span> <span class="variable">fastConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastJsonHttpMessageConverter</span>();</span><br><span class="line">    <span class="type">FastJsonConfig</span> <span class="variable">fastJsonConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastJsonConfig</span>();</span><br><span class="line">    fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">    fastJsonConfig.setDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">	</span><br><span class="line">    SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">    fastJsonConfig.setSerializeConfig(SerializeConfig.globalInstance);</span><br><span class="line">    fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">    HttpMessageConverter&lt;?&gt; converter = fastConverter;</span><br><span class="line">    <span class="keyword">return</span> converter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    converters.add(fastJsonHttpMessageConverters());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4友链查询"><a href="#3-4友链查询" class="headerlink" title="3.4友链查询"></a>3.4友链查询</h3><h4 id="3-4-1表字段分析"><a href="#3-4-1表字段分析" class="headerlink" title="3.4.1表字段分析"></a>3.4.1表字段分析</h4><p><img src="/2023/05/29/blog/image-20230605103507387.png" alt="image-20230605103507387"></p>
<h4 id="3-4-2需求"><a href="#3-4-2需求" class="headerlink" title="3.4.2需求"></a>3.4.2需求</h4><p>  条件：在友链页面查询出所有  审核通过  的友链</p>
<p><img src="/2023/05/29/blog/image-20230605104357216.png" alt="image-20230605104357216"></p>
<h4 id="3-4-3接口设计"><a href="#3-4-3接口设计" class="headerlink" title="3.4.3接口设计"></a>3.4.3接口设计</h4><p>见controller</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dada&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-4代码实现"><a href="#3-4-4代码实现" class="headerlink" title="3.4.4代码实现"></a>3.4.4代码实现</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/link&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LinkService linkService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAllLink&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getAllLink</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> linkService.getAllLink();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;linkService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;LinkMapper, Link&gt; <span class="keyword">implements</span> <span class="title class_">LinkService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getAllLink</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询所有审核通过的</span></span><br><span class="line">        LambdaQueryWrapper&lt;Link&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Link::getStatus, SystemConstants.LINK_STATUS_NORMAL);</span><br><span class="line">        List&lt;Link&gt; links = list(queryWrapper);</span><br><span class="line">        <span class="comment">//转换成vo</span></span><br><span class="line">        List&lt;LinkVo&gt; linkVos = BeanCopyUtils.copyBeanList(links, LinkVo.class);</span><br><span class="line">        <span class="comment">//封装返回</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(linkVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SystemConstants</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 友链状态为审核通过</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span>  <span class="variable">LINK_STATUS_NORMAL</span> <span class="operator">=</span> <span class="string">&quot;0&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-5登录功能实现（springsecurity）"><a href="#3-5登录功能实现（springsecurity）" class="headerlink" title="3.5登录功能实现（springsecurity）"></a>3.5登录功能实现（springsecurity）</h3><h4 id="3-5-0-需求"><a href="#3-5-0-需求" class="headerlink" title="3.5.0 需求"></a>3.5.0 需求</h4><p>​	需要实现登录功能</p>
<p>​	有些功能必须登录后才能使用，未登录状态是不能使用的。</p>
<h4 id="3-5-1-接口设计"><a href="#3-5-1-接口设计" class="headerlink" title="3.5.1 接口设计"></a>3.5.1 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;login</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;1234&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0ODBmOThmYmJkNmI0NjM0OWUyZjY2NTM0NGNjZWY2NSIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY0Mzg3NDMxNiwiZXhwIjoxNjQzOTYwNzE2fQ.ldLBUvNIxQCGemkCoMgT_0YsjsWndTg5tqfJb77pabk&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F3bf9c263bc0f2ac5c3a7feb9e218d07475573ec8.gi&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-表分析"><a href="#3-5-2-表分析" class="headerlink" title="3.5.2 表分析"></a>3.5.2 表分析</h4><p>​	建表SQL	顺便生成下User和UserMapper后面会用到</p>
<h4 id="3-5-3-思路分析"><a href="#3-5-3-思路分析" class="headerlink" title="3.5.3 思路分析"></a>3.5.3 思路分析</h4><p>为了方便理解，放几张学习springsecurity的图：</p>
<h5 id="登陆校验流程"><a href="#登陆校验流程" class="headerlink" title="登陆校验流程"></a>登陆校验流程</h5><p><img src="/2023/05/29/blog/image-20211215094003288.png" alt="image-20211215094003288"></p>
<h5 id="SpringSecurity完整流程"><a href="#SpringSecurity完整流程" class="headerlink" title="SpringSecurity完整流程"></a>SpringSecurity完整流程</h5><p><img src="/2023/05/29/blog/image-20211214144425527.png" alt="image-20211214144425527"></p>
<p><strong>UsernamePasswordAuthenticationFilter</strong>:负责处理我们在登陆页面填写了用户名密码后的登陆请求。入门案例的认证工作主要由它负责。</p>
<p><strong>ExceptionTranslationFilter：</strong>处理过滤器链中抛出的任何AccessDeniedException和AuthenticationException 。</p>
<p><strong>FilterSecurityInterceptor：</strong>负责权限校验的过滤器。</p>
<p>这三个过滤器正式SpringSecurit框架中最核心的东西，分别对应了 <strong>认证</strong>，<strong>处理认证失败和权限不足</strong>，<strong>授权</strong>。</p>
<h5 id="认证流程详解"><a href="#认证流程详解" class="headerlink" title="认证流程详解"></a>认证流程详解</h5><p><img src="/2023/05/29/blog/image-20211214151515385.png" alt="image-20211214151515385"></p>
<p>Authentication接口: 它的实现类，表示当前访问系统的用户，封装了用户相关信息。</p>
<p>AuthenticationManager接口：定义了认证Authentication的方法 </p>
<p>UserDetailsService接口：加载用户特定数据的核心接口。里面定义了一个根据用户名查询用户信息的方法。</p>
<p>UserDetails接口：提供核心用户信息。通过UserDetailsService根据用户名获取处理的用户信息要封装成UserDetails对象返回。然后将这些信息封装到Authentication对象中。</p>
<h4 id="3-5-4登录认证代码实现"><a href="#3-5-4登录认证代码实现" class="headerlink" title="3.5.4登录认证代码实现"></a>3.5.4登录认证代码实现</h4><p>思路</p>
<p>​	①自定义登录接口  </p>
<p>​				调用ProviderManager的方法进行认证 如果认证通过生成jwt</p>
<p>​				把用户信息存入redis中</p>
<p>​	②自定义UserDetailsService </p>
<p>​				在这个实现类中去查询数据库</p>
<p>​	注意配置passwordEncoder为BCryptPasswordEncoder</p>
<p>1.第一步就是controller层的编写，这里面的判断先暂时不管</p>
<p><img src="/2023/05/29/blog/image-20230618073438434.png" alt="image-20230618073438434"></p>
<p>2.第二步是用Authentication接收传入的用户名和密码，这里的参数是authentication，我们用该接口的一个实现类，即UsernamePasswordAuthenticationToken，该实现类会自动调用UserDetailsServiceImpl方法，进行用户名的验证，并且返回一个UserDetails对象，不过被我们封装成了一个LoginUser对象。LoginUser对象里应该还有授权信息，此处还未实现。</p>
<p><img src="/2023/05/29/blog/image-20230618073805510.png" alt="image-20230618073805510"></p>
<p><img src="/2023/05/29/blog/image-20230618073827870.png" alt="image-20230618073827870"></p>
<h4 id="3-6-5-登录校验过滤器代码实现"><a href="#3-6-5-登录校验过滤器代码实现" class="headerlink" title="3.6.5 登录校验过滤器代码实现"></a>3.6.5 登录校验过滤器代码实现</h4><p>思路</p>
<p>​	①定义Jwt认证过滤器</p>
<p>​				获取token</p>
<p>​				解析token获取其中的userid</p>
<p>​				从redis中获取用户信息</p>
<p>​				存入SecurityContextHolder</p>
<p>JwtAuthenticationTokenFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取请求头中的token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(token))&#123;</span><br><span class="line">            <span class="comment">//说明该接口不需要登录  直接放行</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析获取userid</span></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = JwtUtil.parseJWT(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//token超时  token非法</span></span><br><span class="line">            <span class="comment">//响应告诉前端需要重新登录</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> claims.getSubject();</span><br><span class="line">        <span class="comment">//从redis中获取用户信息</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisCache.getCacheObject(<span class="string">&quot;bloglogin:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//如果获取不到</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(loginUser))&#123;</span><br><span class="line">            <span class="comment">//说明登录过期  提示重新登录</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//存入SecurityContextHolder</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// 对于登录接口 允许匿名访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//jwt过滤器测试用，如果测试没有问题吧这里删除了</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/link/getAllLink&quot;</span>).authenticated()</span><br><span class="line">                <span class="comment">// 除上面外的所有请求全部不需要认证即可访问</span></span><br><span class="line">                .anyRequest().permitAll();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        http.logout().disable();</span><br><span class="line">        <span class="comment">//把jwtAuthenticationTokenFilter添加到SpringSecurity的过滤器链中</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        <span class="comment">//允许跨域</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-6-6认证授权失败处理"><a href="#3-6-6认证授权失败处理" class="headerlink" title="3.6.6认证授权失败处理"></a>3.6.6认证授权失败处理</h4><p>​	目前我们的项目在认证出错或者权限不足的时候响应回来的Json是Security的异常处理结果。但是这个响应的格式肯定是不符合我们项目的接口规范的。所以需要自定义异常处理。</p>
<p>​	AuthenticationEntryPoint 认证失败处理器</p>
<p>​	AccessDeniedHandler 授权失败处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationEntryPointImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        authException.printStackTrace();</span><br><span class="line">        <span class="comment">//InsufficientAuthenticationException</span></span><br><span class="line">        <span class="comment">//BadCredentialsException</span></span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(authException <span class="keyword">instanceof</span> BadCredentialsException)&#123;</span><br><span class="line">            result = ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_ERROR.getCode(),authException.getMessage());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(authException <span class="keyword">instanceof</span> InsufficientAuthenticationException)&#123;</span><br><span class="line">            result = ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            result = ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(),<span class="string">&quot;认证或授权失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//响应给前端</span></span><br><span class="line">        WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedHandlerImpl</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        accessDeniedException.printStackTrace();</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NO_OPERATOR_AUTH);</span><br><span class="line">        <span class="comment">//响应给前端</span></span><br><span class="line">        WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置Security异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AuthenticationEntryPoint authenticationEntryPoint;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AccessDeniedHandler accessDeniedHandler;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// 对于登录接口 允许匿名访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//jwt过滤器测试用，如果测试没有问题吧这里删除了</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/link/getAllLink&quot;</span>).authenticated()</span><br><span class="line">                <span class="comment">// 除上面外的所有请求全部不需要认证即可访问</span></span><br><span class="line">                .anyRequest().permitAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置异常处理器</span></span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">                .accessDeniedHandler(accessDeniedHandler);</span><br><span class="line"></span><br><span class="line">        http.logout().disable();</span><br><span class="line">        <span class="comment">//把jwtAuthenticationTokenFilter添加到SpringSecurity的过滤器链中</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        <span class="comment">//允许跨域</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-6查询评论列表"><a href="#3-6查询评论列表" class="headerlink" title="3.6查询评论列表"></a>3.6查询评论列表</h3><h4 id="3-6-1表字段分析"><a href="#3-6-1表字段分析" class="headerlink" title="3.6.1表字段分析"></a>3.6.1表字段分析</h4><p><img src="/2023/05/29/blog/image-20230605105328616.png" alt="image-20230605105328616"></p>
<p>其中，root_id如果是-1就是根评论，to_comment_user_id 如果是根评论，就是-1如果不是根评论，就根据toCommentUserId查询用户的昵称并赋值</p>
<h4 id="3-6-2需求"><a href="#3-6-2需求" class="headerlink" title="3.6.2需求"></a>3.6.2需求</h4><p><img src="/2023/05/29/blog/image-20230605112900995.png" alt="image-20230605112900995"></p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你说啥？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-30 10:06:21&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentUserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asS&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-29 07:59:22&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-6-3代码实现"><a href="#3-6-3代码实现" class="headerlink" title="3.6.3代码实现"></a>3.6.3代码实现</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CommentService commentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/commentList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(Long articleId,Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> commentService.commentList(articleId,pageNum,pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;commentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CommentMapper, Comment&gt; <span class="keyword">implements</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="comment">//查询对应文章的根评论</span></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//对articleId进行判断</span></span><br><span class="line">        lqw.eq(Comment::getArticleId,articleId);</span><br><span class="line">        <span class="comment">//根评论 rootId为-1</span></span><br><span class="line">        lqw.eq(Comment::getRootId,-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//分页查询</span></span><br><span class="line">        Page&lt;Comment&gt; commentPage =<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page(commentPage,lqw);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装vo</span></span><br><span class="line">        List&lt;CommentVo&gt; commentVoList = toCommentVoList(commentPage.getRecords());</span><br><span class="line">        <span class="comment">//查询所有根评论对应的子评论集合，并且赋值给对应的属性</span></span><br><span class="line">        <span class="keyword">for</span> (CommentVo commentVo : commentVoList) &#123;</span><br><span class="line">            <span class="comment">//查询对应的子评论</span></span><br><span class="line">            List&lt;CommentVo&gt; children = getChildren(commentVo.getId());</span><br><span class="line">            <span class="comment">//赋值</span></span><br><span class="line">            commentVo.setChildren(children);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(commentVoList,commentPage.getTotal()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;CommentVo&gt; <span class="title function_">toCommentVoList</span><span class="params">(List&lt;Comment&gt; commentList)</span>&#123;</span><br><span class="line">        List&lt;CommentVo&gt; commentVos = BeanCopyUtils.copyBeanList(commentList, CommentVo.class);</span><br><span class="line">        <span class="comment">//遍历集合</span></span><br><span class="line">        <span class="keyword">for</span>(CommentVo commentVo:commentVos)&#123;</span><br><span class="line">            <span class="comment">//通过creatyBy查询用户的昵称并赋值</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">nickName</span> <span class="operator">=</span> userService.getById(commentVo.getCreateBy()).getNickName();</span><br><span class="line">            <span class="comment">//通过toCommentUserId查询用户的昵称并赋值</span></span><br><span class="line">            commentVo.setUsername(nickName);</span><br><span class="line">            <span class="comment">//toCommentUserId不为-1才进行查询</span></span><br><span class="line">            <span class="keyword">if</span>(commentVo.getToCommentUserId()!=-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">toCommentUserName</span> <span class="operator">=</span> userService.getById(commentVo.getToCommentUserId()).getNickName();</span><br><span class="line">                commentVo.setToCommentUserName(toCommentUserName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据根评论的id查询所对应的子评论的集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 根评论的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; <span class="title function_">getChildren</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Comment::getRootId,id);</span><br><span class="line">        queryWrapper.orderByAsc(Comment::getCreateTime);</span><br><span class="line">        List&lt;Comment&gt; comments = list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;CommentVo&gt; commentVos = toCommentVoList(comments);</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>VO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//文章id</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">//根评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long rootId;</span><br><span class="line">    <span class="comment">//评论内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//所回复的目标评论的userid</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentUserId;</span><br><span class="line">    <span class="keyword">private</span> String toCommentUserName;</span><br><span class="line">    <span class="comment">//回复目标评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-7发表评论"><a href="#3-7发表评论" class="headerlink" title="3.7发表评论"></a>3.7发表评论</h3><h4 id="3-7-1需求"><a href="#3-7-1需求" class="headerlink" title="3.7.1需求"></a>3.7.1需求</h4><p>​	用户登录后可以对文章发表评论，也可以对评论进行回复。</p>
<p>​	用户登录后也可以在友链页面进行评论。</p>
<h4 id="3-7-2接口设计"><a href="#3-7-2接口设计" class="headerlink" title="3.7.2接口设计"></a>3.7.2接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;comment</td>
<td>需要token头</td>
</tr>
</tbody></table>
<p>请求体：</p>
<p>回复了文章：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span><span class="number">-1</span><span class="punctuation">,</span><span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span><span class="number">-1</span><span class="punctuation">,</span><span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span><span class="number">-1</span><span class="punctuation">,</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;评论了文章&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>回复了某条评论：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;回复了某条评论&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果是友链评论，type应该为1</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-7-3代码实现："><a href="#3-7-3代码实现：" class="headerlink" title="3.7.3代码实现："></a>3.7.3代码实现：</h4><p>CommentController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addComment</span><span class="params">(<span class="meta">@RequestBody</span> Comment comment)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> commentService.addComment(comment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CommentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseResult <span class="title function_">addComment</span><span class="params">(Comment comment)</span>;</span><br></pre></td></tr></table></figure>

<p>CommentServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addComment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">    <span class="comment">//评论内容不能为空</span></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.hasText(comment.getContent()))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.CONTENT_NOT_NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    save(comment);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SecurityUtils</p>
<p>这里能拿创建者的id，是区别于瑞吉外卖里同一线程获取id，是另一种实现思路。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 三更  B站： https://space.bilibili.com/663528522</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityUtils</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (LoginUser) getAuthentication().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Authentication</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Authentication <span class="title function_">getAuthentication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isAdmin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> getLoginUser().getUser().getId();</span><br><span class="line">        <span class="keyword">return</span> id != <span class="literal">null</span> &amp;&amp; <span class="number">1L</span> == id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getLoginUser().getUser().getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置MP字段自动填充</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = SecurityUtils.getUserId();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            userId = -<span class="number">1L</span>;<span class="comment">//表示是自己创建</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createBy&quot;</span>,userId , metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, userId, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot; &quot;</span>, SecurityUtils.getUserId(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用注解标识哪些字段在什么情况下需要自动填充</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建人的用户id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createBy;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新人</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateBy;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure>



<h3 id="3-8-友联评论列表"><a href="#3-8-友联评论列表" class="headerlink" title="3.8 友联评论列表"></a>3.8 友联评论列表</h3><h4 id="3-8-1-需求"><a href="#3-8-1-需求" class="headerlink" title="3.8.1 需求"></a>3.8.1 需求</h4><p>​	友链页面也需要查询对应的评论列表。</p>
<h4 id="3-8-2-接口设计"><a href="#3-8-2-接口设计" class="headerlink" title="3.8.2 接口设计"></a>3.8.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;comment&#x2F;linkCommentList</td>
<td>不需要token请求头</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;articleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;回复友链评论3&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-30 10:08:50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;toCommentUserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;友链评论2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-30 10:08:28&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rootId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;toCommentId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;toCommentUserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="3-8-3-代码实现"><a href="#3-8-3-代码实现" class="headerlink" title="3.8.3 代码实现"></a>3.8.3 代码实现</h4><p>CommentController 修改了之前的文章评论列表接口，并且增加了新的友联评论接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/commentList&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(Long articleId,Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> commentService.commentList(SystemConstants.ARTICLE_COMMENT,articleId,pageNum,pageSize);</span><br><span class="line">&#125;   </span><br><span class="line"><span class="meta">@GetMapping(&quot;/linkCommentList&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">linkCommentList</span><span class="params">(Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> commentService.commentList(SystemConstants.LINK_COMMENT,<span class="literal">null</span>,pageNum,pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SystemConstants增加了两个常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论类型为：文章评论</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ARTICLE_COMMENT</span> <span class="operator">=</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论类型为：友联评论</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LINK_COMMENT</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br></pre></td></tr></table></figure>





<p>CommentService修改了commentList方法，增加了一个参数commentType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseResult <span class="title function_">commentList</span><span class="params">(String commentType, Long articleId, Integer pageNum, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure>



<p>CommentServiceImpl修改commentList方法的代码，必须commentType为0的时候才增加articleId的判断，并且增加了一个评论类型的添加。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(String commentType, Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">    <span class="comment">//查询对应文章的根评论</span></span><br><span class="line">    LambdaQueryWrapper&lt;Comment&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//对articleId进行判断</span></span><br><span class="line">    queryWrapper.eq(SystemConstants.ARTICLE_COMMENT.equals(commentType),Comment::getArticleId,articleId);</span><br><span class="line">    <span class="comment">//根评论 rootId为-1</span></span><br><span class="line">    queryWrapper.eq(Comment::getRootId,-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//评论类型</span></span><br><span class="line">    queryWrapper.eq(Comment::getType,commentType);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(pageNum,pageSize);</span><br><span class="line">    page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">    List&lt;CommentVo&gt; commentVoList = toCommentVoList(page.getRecords());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有根评论对应的子评论集合，并且赋值给对应的属性</span></span><br><span class="line">    <span class="keyword">for</span> (CommentVo commentVo : commentVoList) &#123;</span><br><span class="line">        <span class="comment">//查询对应的子评论</span></span><br><span class="line">        List&lt;CommentVo&gt; children = getChildren(commentVo.getId());</span><br><span class="line">        <span class="comment">//赋值</span></span><br><span class="line">        commentVo.setChildren(children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(commentVoList,page.getTotal()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-9-个人信息查询接口"><a href="#3-9-个人信息查询接口" class="headerlink" title="3.9 个人信息查询接口"></a>3.9 个人信息查询接口</h3><h4 id="3-9-1-需求"><a href="#3-9-1-需求" class="headerlink" title="3.9.1 需求"></a>3.9.1 需求</h4><p>​	进入个人中心的时候需要能够查看当前用户信息</p>
<h4 id="3-9-2-接口设计"><a href="#3-9-2-接口设计" class="headerlink" title="3.9.2 接口设计"></a>3.9.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;user&#x2F;userInfo</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>不需要参数</p>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F3bf9c263bc0f2ac5c3a7feb9e218d07475573ec8.gi&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-9-3-代码实现"><a href="#3-9-3-代码实现" class="headerlink" title="3.9.3 代码实现"></a>3.9.3 代码实现</h4><p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userInfo&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> ResponseResult <span class="title function_">userInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.userInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>UserService增加方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    ResponseResult <span class="title function_">userInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>UserServiceImpl实现userInfo方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前用户id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId();</span><br><span class="line">    <span class="comment">//根据用户id查询用户信息</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(userId);</span><br><span class="line">    <span class="comment">//封装成UserInfoVo</span></span><br><span class="line">    <span class="type">UserInfoVo</span> <span class="variable">vo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user,UserInfoVo.class);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(vo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SecurityConfig配置该接口必须认证后才能访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     http</span><br><span class="line">             <span class="comment">//关闭csrf</span></span><br><span class="line">             .csrf().disable()</span><br><span class="line">             <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">             .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">             .and()</span><br><span class="line">             .authorizeRequests()</span><br><span class="line">             <span class="comment">// 对于登录接口 允许匿名访问</span></span><br><span class="line">             .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">             <span class="comment">//注销接口需要认证才能访问</span></span><br><span class="line">             .antMatchers(<span class="string">&quot;/logout&quot;</span>).authenticated()</span><br><span class="line">         	<span class="comment">//个人信息接口必须登录后才能访问</span></span><br><span class="line">             .antMatchers(<span class="string">&quot;/user/userInfo&quot;</span>).authenticated()</span><br><span class="line">             <span class="comment">// 除上面外的所有请求全部不需要认证即可访问</span></span><br><span class="line">             .anyRequest().permitAll();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//配置异常处理器</span></span><br><span class="line">     http.exceptionHandling()</span><br><span class="line">             .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">             .accessDeniedHandler(accessDeniedHandler);</span><br><span class="line">     <span class="comment">//关闭默认的注销功能</span></span><br><span class="line">     http.logout().disable();</span><br><span class="line">     <span class="comment">//把jwtAuthenticationTokenFilter添加到SpringSecurity的过滤器链中</span></span><br><span class="line">     http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">     <span class="comment">//允许跨域</span></span><br><span class="line">     http.cors();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-10头像上传接口"><a href="#3-10头像上传接口" class="headerlink" title="3.10头像上传接口"></a>3.10头像上传接口</h3><h4 id="3-10-1需求"><a href="#3-10-1需求" class="headerlink" title="3.10.1需求"></a>3.10.1需求</h4><p>在个人中心点击编辑可以上传头像图片。</p>
<h4 id="3-10-2Oss"><a href="#3-10-2Oss" class="headerlink" title="3.10.2Oss"></a>3.10.2Oss</h4><p>为什么要使用Oss？</p>
<p>因为如果把图片视频等文件上传到自己的应用的Web服务器，在读取图片的时候会占用比较多的资源，影响服务器的性能</p>
<h4 id="3-10-3七牛云基本使用"><a href="#3-10-3七牛云基本使用" class="headerlink" title="3.10.3七牛云基本使用"></a>3.10.3七牛云基本使用</h4><p>第一步：注册七牛云账号并且认证</p>
<p>第二步：创建存储空间</p>
<p>第三步：记录sk和ak</p>
<h4 id="3-10-4七牛云测试代码编写"><a href="#3-10-4七牛云测试代码编写" class="headerlink" title="3.10.4七牛云测试代码编写"></a>3.10.4七牛云测试代码编写</h4><p>①添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>[7.7.0, 7.7.99]<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②复制修改案例代码</p>
<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oss:</span></span><br><span class="line">  <span class="attr">accessKey:</span> <span class="string">xxxx</span></span><br><span class="line">  <span class="attr">secretKey:</span> <span class="string">xxxx</span></span><br><span class="line">  <span class="attr">bucket:</span> <span class="string">sg-blog</span></span><br></pre></td></tr></table></figure>

<p>OSSTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;oss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OSSTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccessKey</span><span class="params">(String accessKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accessKey = accessKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSecretKey</span><span class="params">(String secretKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.secretKey = secretKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBucket</span><span class="params">(String bucket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bucket = bucket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOss</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定 Region 对象的配置类</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Region.autoRegion());</span><br><span class="line">        <span class="comment">//...其他参数参考类注释</span></span><br><span class="line"></span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line">        <span class="comment">//...生成上传凭证，然后准备上传</span></span><br><span class="line"><span class="comment">//        String accessKey = &quot;your access key&quot;;</span></span><br><span class="line"><span class="comment">//        String secretKey = &quot;your secret key&quot;;</span></span><br><span class="line"><span class="comment">//        String bucket = &quot;sg-blog&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;2022/sg.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            byte[] uploadBytes = &quot;hello qiniu cloud&quot;.getBytes(&quot;utf-8&quot;);</span></span><br><span class="line"><span class="comment">//            ByteArrayInputStream byteInputStream=new ByteArrayInputStream(uploadBytes);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//这里先指定传某个文件，作为测试</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\root\\Desktop\\Snipaste_2022-02-28_22-48-37.png&quot;</span>);</span><br><span class="line">            <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(inputStream,key,upToken,<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//解析上传成功的结果</span></span><br><span class="line">                <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">                System.out.println(putRet.key);</span><br><span class="line">                System.out.println(putRet.hash);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">                System.err.println(r.toString());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.err.println(r.bodyString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                    <span class="comment">//ignore</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到在七牛云的个人仓库里有刚刚上传的图片。测试成功</p>
<p><img src="/2023/05/29/blog/image-20230619094239213.png" alt="image-20230619094239213"></p>
<h4 id="3-10-5接口设计"><a href="#3-10-5接口设计" class="headerlink" title="3.10.5接口设计"></a>3.10.5接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;upload</td>
<td>需要token</td>
</tr>
</tbody></table>
<p>参数：</p>
<p>​	img,值为要上传的文件</p>
<p>请求头：</p>
<p>​	Content-Type ：multipart&#x2F;form-data;</p>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文件访问链接&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-10-6代码实现"><a href="#3-10-6代码实现" class="headerlink" title="3.10.6代码实现"></a>3.10.6代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadService uploadService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImg</span><span class="params">(MultipartFile img)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> uploadService.uploadImg(img);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解读一下代码：</span></span><br><span class="line"><span class="comment">//1.@ConfigurationProperties(prefix = &quot;oss&quot;)这个注解可以根据前缀oss.xxx拿到存在yml文件里配置的信息</span></span><br><span class="line"><span class="comment">//2.判断是png之后，把源文件名传入工具类PathUtils生成文件名称</span></span><br><span class="line"><span class="comment">//3.前端返回的url路径，是调用uploadOss方法，这个方法中先接收传入的图片并且上传然后返回了url</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;oss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UploadService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImg</span><span class="params">(MultipartFile img)</span> &#123;</span><br><span class="line">        <span class="comment">//判断文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> img.getOriginalFilename();</span><br><span class="line">        <span class="comment">//后缀只能是png</span></span><br><span class="line">        <span class="keyword">if</span>(!originalFilename.endsWith(<span class="string">&quot;.png&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.FILL_TYPE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果通过判断上传到oss</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> PathUtils.generateFilePath(originalFilename);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span>uploadOss(img,filePath);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(url);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">uploadOss</span><span class="params">(MultipartFile imgFile, String filePath)</span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定 Region 对象的配置类</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Region.autoRegion());</span><br><span class="line">        <span class="comment">//...其他参数参考类注释</span></span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line">        <span class="comment">//...生成上传凭证，然后准备上传</span></span><br><span class="line"><span class="comment">//        String accessKey = &quot;1C0Iw8cvGGbP6tbltr_6Y7dGrM1gJSeSS0yzszQ&quot;;</span></span><br><span class="line"><span class="comment">//        String secretKey = &quot;17ngorE0xxa_oza0k4yBDpjW1xZgPZQln5BBRxH4&quot;;</span></span><br><span class="line"><span class="comment">//        String bucket = &quot;pureblog&quot;;</span></span><br><span class="line">        <span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> filePath;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            byte[] uploadBytes = &quot;hello qiniu cloud&quot;.getBytes(&quot;utf-8&quot;);</span></span><br><span class="line"><span class="comment">//            ByteArrayInputStream byteInputStream=new ByteArrayInputStream(uploadBytes);</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span>imgFile.getInputStream();</span><br><span class="line"><span class="comment">//            InputStream inputStream = new FileInputStream(&quot;C:\\Users\\86138\\Pictures\\Camera Roll\\gaomu.jpg&quot;);</span></span><br><span class="line">            <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(inputStream,key,upToken,<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//解析上传成功的结果</span></span><br><span class="line">                <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">                System.out.println(putRet.key);</span><br><span class="line">                System.out.println(putRet.hash);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;http://rwh2xibjm.hb-bkt.clouddn.com/&quot;</span> +key;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">                System.err.println(r.toString());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.err.println(r.bodyString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                    <span class="comment">//ignore</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;www&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/05/29/blog/image-20230619095534762.png" alt="image-20230619095534762"></p>
<p>PathUitls：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateFilePath</span><span class="params">(String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//根据日期生成路径   2022/1/15/</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd/&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">datePath</span> <span class="operator">=</span> sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">//uuid作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//后缀和文件后缀一致</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="comment">// test.jpg -&gt; .jpg</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> fileName.substring(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(datePath).append(uuid).append(fileType).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-11更新个人信息接口"><a href="#3-11更新个人信息接口" class="headerlink" title="3.11更新个人信息接口"></a>3.11更新个人信息接口</h3><h4 id="3-11-1接口设计"><a href="#3-11-1接口设计" class="headerlink" title="3.11.1接口设计"></a>3.11.1接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;user&#x2F;userInfo</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>参数</p>
<p>请求体中json格式数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/01/31/948597e164614902ab1662ba8452e106.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-11-2代码实现"><a href="#3-11-2代码实现" class="headerlink" title="3.11.2代码实现"></a>3.11.2代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/userInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateUserInfo</span><span class="params">(<span class="meta">@RequestBody</span>  User user)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.updateUserInfo(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对个人信息进行更新</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateUserInfo</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    updateById(user);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成功：</p>
<p><img src="/2023/05/29/blog/image-20230619101513801.png" alt="image-20230619101513801"></p>
<h3 id="3-12用户注册"><a href="#3-12用户注册" class="headerlink" title="3.12用户注册"></a>3.12用户注册</h3><h4 id="3-12-1需求"><a href="#3-12-1需求" class="headerlink" title="3.12.1需求"></a>3.12.1需求</h4><p>​	要求用户能够在注册界面完成用户的注册。要求用户名，昵称，邮箱不能和数据库中原有的数据重复。如果某项重复了注册失败并且要有对应的提示。并且要求用户名，密码，昵称，邮箱都不能为空。（StringUtils.hasText）</p>
<p>​	注意:密码必须密文存储到数据库中。</p>
<h4 id="3-12-2接口设计"><a href="#3-12-2接口设计" class="headerlink" title="3.12.2接口设计"></a>3.12.2接口设计</h4><p>​	 </p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;user&#x2F;register</td>
<td>不需要token请求头</td>
</tr>
</tbody></table>
<p>参数</p>
<p>请求体中json格式数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-12-3代码实现"><a href="#3-12-3代码实现" class="headerlink" title="3.12.3代码实现"></a>3.12.3代码实现</h4><p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> userService.register(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询个人信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//SecurityUtils这个工具类拿到id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId();</span><br><span class="line">        <span class="comment">//根据登录id查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(userId);</span><br><span class="line">        <span class="comment">//封装成UserInfoVo</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">vo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user,UserInfoVo.class);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(vo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对个人信息进行更新</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateUserInfo</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        updateById(user);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//对数据进行非空判断</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_NOT_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PASSWORD_NOT_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getEmail()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_NOT_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getNickName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_NOT_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对数据进行是否存在的判断</span></span><br><span class="line">        <span class="keyword">if</span>(userNameExist(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nickNameExist(user.getNickName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(emailExist(user.getEmail()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对密码进行加密</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encodePassword</span> <span class="operator">=</span> passwordEncoder.encode(user.getPassword());</span><br><span class="line">        user.setPassword(encodePassword);</span><br><span class="line">        <span class="comment">//存入数据库</span></span><br><span class="line">        save(user);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">emailExist</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lqw.eq(User::getEmail,email);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> count(lqw);</span><br><span class="line">        <span class="keyword">return</span> count&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">nickNameExist</span><span class="params">(String nickName)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lqw.eq(User::getNickName,nickName);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> count(lqw);</span><br><span class="line">        <span class="keyword">return</span> count&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">userNameExist</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lqw.eq(User::getUserName,userName);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> count(lqw);</span><br><span class="line">        <span class="keyword">return</span> count&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AppHttpCodeEnum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AppHttpCodeEnum</span> &#123;</span><br><span class="line">    <span class="comment">// 成功</span></span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    NEED_LOGIN(<span class="number">401</span>,<span class="string">&quot;需要登录后操作&quot;</span>),</span><br><span class="line">    NO_OPERATOR_AUTH(<span class="number">403</span>,<span class="string">&quot;无权限操作&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">500</span>,<span class="string">&quot;出现错误&quot;</span>),</span><br><span class="line">    USERNAME_EXIST(<span class="number">501</span>,<span class="string">&quot;用户名已存在&quot;</span>),</span><br><span class="line">    PHONENUMBER_EXIST(<span class="number">502</span>,<span class="string">&quot;手机号已存在&quot;</span>), EMAIL_EXIST(<span class="number">503</span>, <span class="string">&quot;邮箱已存在&quot;</span>),</span><br><span class="line">    REQUIRE_USERNAME(<span class="number">504</span>, <span class="string">&quot;必需填写用户名&quot;</span>),</span><br><span class="line">    CONTENT_NOT_NULL(<span class="number">506</span>,<span class="string">&quot;评论内容不能为空&quot;</span>),</span><br><span class="line">    FILL_TYPE_ERROR(<span class="number">507</span>,<span class="string">&quot;文件类型错误，只能上传png文件&quot;</span>),</span><br><span class="line">    USERNAME_NOT_NULL(<span class="number">508</span>,<span class="string">&quot;用户名不能为空&quot;</span>),</span><br><span class="line">    PASSWORD_NOT_NULL(<span class="number">509</span>,<span class="string">&quot;密码不能为空&quot;</span>),</span><br><span class="line">    NICKNAME_NOT_NULL(<span class="number">509</span>, <span class="string">&quot;昵称不能为空&quot;</span>),</span><br><span class="line">    EMAIL_NOT_NULL(<span class="number">511</span>, <span class="string">&quot;邮箱不能为空&quot;</span>),</span><br><span class="line">    NICKNAME_EXIST(<span class="number">512</span>, <span class="string">&quot;昵称已存在&quot;</span>),</span><br><span class="line"></span><br><span class="line">    LOGIN_ERROR(<span class="number">505</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>成功：</p>
<p><img src="/2023/05/29/blog/image-20230619105118698.png" alt="image-20230619105118698"></p>
<h3 id="3-13Aop实现日志功能"><a href="#3-13Aop实现日志功能" class="headerlink" title="3.13Aop实现日志功能"></a>3.13Aop实现日志功能</h3><h4 id="3-13-1需求"><a href="#3-13-1需求" class="headerlink" title="3.13.1需求"></a>3.13.1需求</h4><p>​	需要通过日志记录接口调用信息。便于后期调试排查。并且可能有很多接口都需要进行日志的记录。</p>
<p>​	接口被调用时日志打印格式如下：</p>
<p><img src="/2023/05/29/blog/image-20220313133714102.png" alt="image-20220313133714102"></p>
<p>​	相当于是对原有的功能进行增强。并且是批量的增强，这个时候就非常适合用AOP来进行实现。</p>
<h4 id="3-13-2代码实现"><a href="#3-13-2代码实现" class="headerlink" title="3.13.2代码实现"></a>3.13.2代码实现</h4><p>打印格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">log.info(<span class="string">&quot;=======Start=======&quot;</span>);</span><br><span class="line"><span class="comment">// 打印请求 URL</span></span><br><span class="line">log.info(<span class="string">&quot;URL            : &#123;&#125;&quot;</span>,);</span><br><span class="line"><span class="comment">// 打印描述信息</span></span><br><span class="line">log.info(<span class="string">&quot;BusinessName   : &#123;&#125;&quot;</span>, );</span><br><span class="line"><span class="comment">// 打印 Http method</span></span><br><span class="line">log.info(<span class="string">&quot;HTTP Method    : &#123;&#125;&quot;</span>, );</span><br><span class="line"><span class="comment">// 打印调用 controller 的全路径以及执行方法</span></span><br><span class="line">log.info(<span class="string">&quot;Class Method   : &#123;&#125;.&#123;&#125;&quot;</span>, );</span><br><span class="line"><span class="comment">// 打印请求的 IP</span></span><br><span class="line">log.info(<span class="string">&quot;IP             : &#123;&#125;&quot;</span>,);</span><br><span class="line"><span class="comment">// 打印请求入参</span></span><br><span class="line">log.info(<span class="string">&quot;Request Args   : &#123;&#125;&quot;</span>,);</span><br><span class="line"><span class="comment">// 打印出参</span></span><br><span class="line">log.info(<span class="string">&quot;Response       : &#123;&#125;&quot;</span>, );</span><br><span class="line"><span class="comment">// 结束后换行</span></span><br><span class="line">log.info(<span class="string">&quot;=======End=======&quot;</span> + System.lineSeparator());</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/2023/05/29/blog/image-20230620085627003.png" alt="image-20230620085627003"></p>
<p><img src="/2023/05/29/blog/image-20230620085640591.png" alt="image-20230620085640591"></p>
<p>中间的部分是mybatisplus的日志。</p>
<p>实现过程：</p>
<p>1.自定义一个注解，注意加上原注解，businessName后面会用到</p>
<p><img src="/2023/05/29/blog/image-20230620085812145.png" alt="image-20230620085812145"></p>
<p>2.定义切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//确定切点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.pure.annotation.SystemLog)&quot;)</span></span><br><span class="line">    <span class="comment">//目前只在usercontroller里的更新方法上加了注解，也只有该方法会有增强</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义通知方法，在更新方法执行的前和后分别执行</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="comment">//joinPoint封装了更新方法，proceed定义了定义了目标方法执行时需要传递的参数，</span></span><br><span class="line">    <span class="comment">// 同时可以获取目标方法的返回值，使得日志记录的信息最完整，包含目标方法的调用参数和调用结果等</span></span><br><span class="line">    <span class="keyword">public</span> Object  <span class="title function_">printLog</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//该结果是目标方法执行后调用的一个返回值</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            handleBefore(joinPoint);</span><br><span class="line">            proceed = joinPoint.proceed();</span><br><span class="line">            handleAfter(proceed);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 结束后换行  获取当前系统的换行符</span></span><br><span class="line">            log.info(<span class="string">&quot;=======End=======&quot;</span> + System.lineSeparator());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleAfter</span><span class="params">(Object proceed)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印出参</span></span><br><span class="line">        log.info(<span class="string">&quot;Response       : &#123;&#125;&quot;</span>,JSON.toJSONString(proceed));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleBefore</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;=======Start=======&quot;</span>);</span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> requestAttributes.getRequest();</span><br><span class="line">        <span class="comment">// 打印请求 URL</span></span><br><span class="line">        <span class="comment">//这里不可能写死，需要获取当前线程中的请求对象</span></span><br><span class="line">        log.info(<span class="string">&quot;URL            : &#123;&#125;&quot;</span>,request.getRequestURI() );</span><br><span class="line">        <span class="comment">// 打印描述信息</span></span><br><span class="line">        <span class="comment">//获取被增强方法上面的注解对象</span></span><br><span class="line">        SystemLog systemLog=getSystemLog(joinPoint);</span><br><span class="line">        log.info(<span class="string">&quot;BusinessName   : &#123;&#125;&quot;</span>,systemLog.businessName() );</span><br><span class="line">        <span class="comment">// 打印 Http method</span></span><br><span class="line">        log.info(<span class="string">&quot;HTTP Method    : &#123;&#125;&quot;</span>, request.getMethod());</span><br><span class="line">        <span class="comment">// 打印调用 controller 的全路径以及执行方法</span></span><br><span class="line">        log.info(<span class="string">&quot;Class Method   : &#123;&#125;.&#123;&#125;&quot;</span>,joinPoint.getSignature().getDeclaringTypeName(),joinPoint.getSignature().getName());</span><br><span class="line">        <span class="comment">// 打印请求的 IP</span></span><br><span class="line">        log.info(<span class="string">&quot;IP             : &#123;&#125;&quot;</span>,request.getRemoteHost());</span><br><span class="line">        <span class="comment">// 打印请求入参</span></span><br><span class="line">        log.info(<span class="string">&quot;Request Args   : &#123;&#125;&quot;</span>, JSON.toJSONString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SystemLog <span class="title function_">getSystemLog</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">//getSignature() 方法是 ProceedingJoinPoint 接口的方法，用于获取当前连接点的方法签名，</span></span><br><span class="line">        <span class="comment">// 返回一个 MethodSignature 对象。MethodSignature 接口实现了 Signature 接口</span></span><br><span class="line">        <span class="comment">// （它是一个通用的方法签名，可以用于任何字符串表示的签名，</span></span><br><span class="line">        <span class="comment">// 如：类名、方法名、参数类型、返回类型等）。MethodSignature 提供了获取方法名、</span></span><br><span class="line">        <span class="comment">// 方法所属类、方法的参数类型列表、方法的返回值类型等信息的方法。</span></span><br><span class="line">        MethodSignature methodSignature=(MethodSignature)joinPoint.getSignature();</span><br><span class="line">        <span class="comment">//getMethod() 方法是 MethodSignature 接口的方法，用于获取当前方法签名的 Method 对象。</span></span><br><span class="line">        <span class="comment">// Method 类提供了获取方法注解、方法修饰符、方法参数列表、方法返回值类型等信息的方法。</span></span><br><span class="line">        <span class="type">SystemLog</span> <span class="variable">systemLog</span> <span class="operator">=</span> methodSignature.getMethod().getAnnotation(SystemLog.class);</span><br><span class="line">        <span class="keyword">return</span>  systemLog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Usercontroller：</p>
<p><img src="/2023/05/29/blog/image-20230620092155610.png" alt="image-20230620092155610"></p>
<h3 id="3-14-更新浏览次数"><a href="#3-14-更新浏览次数" class="headerlink" title="3.14 更新浏览次数"></a>3.14 更新浏览次数</h3><h4 id="3-14-1-需求"><a href="#3-14-1-需求" class="headerlink" title="3.14.1 需求"></a>3.14.1 需求</h4><p>​	在用户浏览博文时要实现对应博客浏览量的增加。</p>
<h4 id="3-14-2-思路分析"><a href="#3-14-2-思路分析" class="headerlink" title="3.14.2 思路分析"></a>3.14.2 思路分析</h4><p>​	我们只需要在每次用户浏览博客时更新对应的浏览数即可。</p>
<p>​	但是如果直接操作博客表的浏览量的话，在并发量大的情况下会出现什么问题呢？</p>
<p>​	如何去优化呢？</p>
<p>①在应用启动时把博客的浏览量存储到redis中</p>
<p>②更新浏览量时去更新redis中的数据</p>
<p>③每隔10分钟把Redis中的浏览量更新到数据库中</p>
<p>④读取文章浏览量时从redis读取</p>
<h4 id="3-14-3-铺垫知识"><a href="#3-14-3-铺垫知识" class="headerlink" title="3.14.3 铺垫知识"></a>3.14.3 铺垫知识</h4><h5 id="3-14-3-1-项目启动时预处理"><a href="#3-14-3-1-项目启动时预处理" class="headerlink" title="3.14.3.1 项目启动时预处理"></a>3.14.3.1 项目启动时预处理</h5><p>​	如果希望在SpringBoot应用启动时进行一些初始化操作可以选择使用CommandLineRunner来进行处理。</p>
<p>​	我们只需要实现CommandLineRunner接口，并且把对应的bean注入容器。把相关初始化的代码重新到需要重新的方法中。</p>
<p>​	这样就会在应用启动的时候执行对应的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;程序初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-14-3-2-定时任务"><a href="#3-14-3-2-定时任务" class="headerlink" title="3.14.3.2 定时任务"></a>3.14.3.2 定时任务</h5><p>​	定时任务的实现方式有很多，比如XXL-Job等。但是其实核心功能和概念都是类似的，很多情况下只是调用的API不同而已。</p>
<p>​	这里就先用SpringBoot为我们提供的定时任务的API来实现一个简单的定时任务，让大家先对定时任务里面的一些核心概念有个大致的了解。</p>
<p>实现步骤</p>
<p>① 使用@EnableScheduling注解开启定时任务功能</p>
<p>​	我们可以在配置类上加上@EnableScheduling</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.sangeng.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SanGengBlogApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SanGengBlogApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>② 确定定时任务执行代码，并配置任务执行时间</p>
<p>​	使用@Scheduled注解标识需要定时执行的代码。注解的cron属性相当于是任务的执行时间。目前可以使用 0&#x2F;5 * * * * ? 进行测试，代表从0秒开始，每隔5秒执行一次。 </p>
<p>​	注意：对应的bean要注入容器，否则不会生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJob</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//要执行的代码</span></span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="3-14-3-2-1cron表达式"><a href="#3-14-3-2-1cron表达式" class="headerlink" title="3.14.3.2.1cron表达式"></a>3.14.3.2.1cron表达式</h6><h4 id="3-14-4-接口设计"><a href="#3-14-4-接口设计" class="headerlink" title="3.14.4 接口设计"></a>3.14.4 接口设计</h4><p>​	 </p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;article&#x2F;updateViewCount&#x2F;{id}</td>
<td>不需要token请求头</td>
</tr>
</tbody></table>
<p>参数</p>
<p>​	请求路径中携带文章id</p>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-14-5-代码实现"><a href="#3-14-5-代码实现" class="headerlink" title="3.14.5 代码实现"></a>3.14.5 代码实现</h4><h5 id="①在应用启动时把博客的浏览量存储到redis中"><a href="#①在应用启动时把博客的浏览量存储到redis中" class="headerlink" title="①在应用启动时把博客的浏览量存储到redis中"></a>①在应用启动时把博客的浏览量存储到redis中</h5><p>​	实现CommandLineRunner接口，在应用启动时初始化缓存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewCountRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleMapper articleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//查询博客信息  id  viewCount</span></span><br><span class="line">        List&lt;Article&gt; articles =articleMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        Map&lt;String,Integer&gt; viewCountMap =articles.stream().</span><br><span class="line">                collect(Collectors.toMap(article -&gt; article.getId().toString(), article -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> article.getViewCount().intValue();</span><br><span class="line">                &#125;));</span><br><span class="line">        <span class="comment">//存储到redis中</span></span><br><span class="line">        redisCache.setCacheMap(<span class="string">&quot;article:viewCount&quot;</span>,viewCountMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②更新浏览量时去更新redsi中的数据</p>
<p>RedisCache工具类中新增方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新浏览量时更新redis中的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> v</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementCacheMapValue</span><span class="params">(String key,String hKey,<span class="type">long</span> v)</span>&#123;</span><br><span class="line">    <span class="comment">//String key 表示 Redis 缓存中的键(Key)，String hKey 表示 Redis</span></span><br><span class="line">    <span class="comment">// 缓存中的Hash键(即Hash Field)，long v 表示需要增加的值</span></span><br><span class="line">    redisTemplate.boundHashOps(key).increment(hKey, v);</span><br><span class="line">    <span class="comment">//获取key对应的 redis 缓存的 Hash 类型值，并调用其方法increment(hKey, v)</span></span><br><span class="line">    <span class="comment">// 对Hash键(hKey)上的值进行增加操作，增加的值为 v。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArticleController中增加方法更新阅读数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/updateViewCount/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateViewCount</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> articleService.updateViewCount(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArticleService中增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseResult <span class="title function_">updateViewCount</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>

<p>ArticleServiceImpl中实现方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateViewCount</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//更新redis中对应 id的浏览量</span></span><br><span class="line">    redisCache.incrementCacheMapValue(<span class="string">&quot;article:viewCount&quot;</span>,id.toString(),<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="③定时任务每隔10分钟把Redis中的浏览量更新到数据库中"><a href="#③定时任务每隔10分钟把Redis中的浏览量更新到数据库中" class="headerlink" title="③定时任务每隔10分钟把Redis中的浏览量更新到数据库中"></a>③定时任务每隔10分钟把Redis中的浏览量更新到数据库中</h5><p>Article中增加构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Article</span><span class="params">(Long id, <span class="type">long</span> viewCount)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.viewCount = viewCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateViewCountJob</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateViewCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取redis中的浏览量</span></span><br><span class="line">        Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(<span class="string">&quot;article:viewCount&quot;</span>);</span><br><span class="line">        List&lt;Article&gt; articles = viewCountMap.entrySet()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(entry -&gt; <span class="keyword">new</span> <span class="title class_">Article</span>(Long.valueOf(entry.getKey()), entry.getValue().longValue()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//更新到数据库中</span></span><br><span class="line">        articleService.updateBatchById(articles);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果自动任务把redis中的浏览量存入数据库的时间设置的长一些，就会数据不同步，不符合需求，所以要从redis中读取数据。这里只实现了查看文章详情方法。</p>
<h5 id="④读取文章浏览量时从redis读取"><a href="#④读取文章浏览量时从redis读取" class="headerlink" title="④读取文章浏览量时从redis读取"></a>④读取文章浏览量时从redis读取</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//根据id查询文章</span></span><br><span class="line">    <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">//从redis中获取viewCount</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> redisCache.getCacheMapValue(<span class="string">&quot;article:viewCount&quot;</span>, id.toString());</span><br><span class="line">    article.setViewCount(viewCount.longValue());</span><br><span class="line">    <span class="comment">//转换成VO</span></span><br><span class="line">    <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line">    <span class="comment">//根据分类id查询分类名</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> articleDetailVo.getCategoryId();</span><br><span class="line">    <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">    <span class="keyword">if</span>(category!=<span class="literal">null</span>)&#123;</span><br><span class="line">        articleDetailVo.setCategoryName(category.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//封装响应返回</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-Swagger2"><a href="#4-Swagger2" class="headerlink" title="4.Swagger2"></a>4.Swagger2</h2><h3 id="4-1-简介"><a href="#4-1-简介" class="headerlink" title="4.1 简介"></a>4.1 简介</h3><p>​	Swagger 是一套基于 OpenAPI 规范构建的开源工具，可以帮助我们设计、构建、记录以及使用 Rest API。</p>
<h3 id="4-2-为什么使用Swagger"><a href="#4-2-为什么使用Swagger" class="headerlink" title="4.2 为什么使用Swagger"></a>4.2 为什么使用Swagger</h3><p>​    当下很多公司都采取前后端分离的开发模式，前端和后端的工作由不同的工程师完成。在这种开发模式下，维持一份及时更新且完整的 Rest API 文档将会极大的提高我们的工作效率。传统意义上的文档都是后端开发人员手动编写的，相信大家也都知道这种方式很难保证文档的及时性，这种文档久而久之也就会失去其参考意义，反而还会加大我们的沟通成本。而 Swagger 给我们提供了一个全新的维护 API 文档的方式，下面我们就来了解一下它的优点：</p>
<p>1.代码变，文档变。只需要少量的注解，Swagger 就可以根据代码自动生成 API 文档，很好的保证了文档的时效性。<br>2.跨语言性，支持 40 多种语言。<br>3.Swagger UI 呈现出来的是一份可交互式的 API 文档，我们可以直接在文档页面尝试 API 的调用，省去了准备复杂的调用参数的过程。</p>
<h3 id="4-3-快速入门"><a href="#4-3-快速入门" class="headerlink" title="4.3 快速入门"></a>4.3 快速入门</h3><h4 id="4-3-1-引入依赖"><a href="#4-3-1-引入依赖" class="headerlink" title="4.3.1 引入依赖"></a>4.3.1 引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="4-3-2-启用Swagger2"><a href="#4-3-2-启用Swagger2" class="headerlink" title="4.3.2 启用Swagger2"></a>4.3.2 启用Swagger2</h4><p>​	在启动类上或者配置类加 @EnableSwagger2 注解</p>
<h4 id="4-3-3-测试"><a href="#4-3-3-测试" class="headerlink" title="4.3.3 测试"></a>4.3.3 测试</h4><p>​	访问：<a target="_blank" rel="noopener" href="http://localhost:7777/swagger-ui.html">http://localhost:7777/swagger-ui.html</a>  注意其中localhost和7777要调整成实际项目的域名和端口号。</p>
<p>ctrl+空格 ，查看注解的属性</p>
<p><img src="/2023/05/29/blog/image-20230620191553532.png" alt="image-20230620191553532"></p>
<h4 id="4-4-1-Controller配置"><a href="#4-4-1-Controller配置" class="headerlink" title="4.4.1 Controller配置"></a>4.4.1 Controller配置</h4><h5 id="4-4-1-Api-注解"><a href="#4-4-1-Api-注解" class="headerlink" title="4.4.1 @Api 注解"></a>4.4.1 @Api 注解</h5><p>属性介绍：</p>
<p>tags  设置标签</p>
<p>description 设置描述信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/comment&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;评论&quot;,description = &quot;评论相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentController</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-4-2-接口配置"><a href="#4-4-2-接口配置" class="headerlink" title="4.4.2 接口配置"></a>4.4.2 接口配置</h4><h5 id="4-4-2-1-接口描述配置-ApiOperation"><a href="#4-4-2-1-接口描述配置-ApiOperation" class="headerlink" title="4.4.2.1 接口描述配置@ApiOperation"></a>4.4.2.1 接口描述配置@ApiOperation</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/linkCommentList&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;友链评论列表&quot;,notes = &quot;获取一页友链评论&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">linkCommentList</span><span class="params">(Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> commentService.commentList(SystemConstants.LINK_COMMENT,<span class="literal">null</span>,pageNum,pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-4-2-2-接口参数描述"><a href="#4-4-2-2-接口参数描述" class="headerlink" title="4.4.2.2 接口参数描述"></a>4.4.2.2 接口参数描述</h5><p> @ApiImplicitParam 用于描述接口的参数，但是一个接口可能有多个参数，所以一般与 @ApiImplicitParams 组合使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/linkCommentList&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;友链评论列表&quot;,notes = &quot;获取一页友链评论&quot;)</span></span><br><span class="line"><span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">       @ApiImplicitParam(name = &quot;pageNum&quot;,value = &quot;页号&quot;),</span></span><br><span class="line"><span class="meta">       @ApiImplicitParam(name = &quot;pageSize&quot;,value = &quot;每页大小&quot;)</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">linkCommentList</span><span class="params">(Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> commentService.commentList(SystemConstants.LINK_COMMENT,<span class="literal">null</span>,pageNum,pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-4-3-实体类配置"><a href="#4-4-3-实体类配置" class="headerlink" title="4.4.3 实体类配置"></a>4.4.3 实体类配置</h4><h5 id="4-4-3-1-实体的描述配置-ApiModel"><a href="#4-4-3-1-实体的描述配置-ApiModel" class="headerlink" title="4.4.3.1 实体的描述配置@ApiModel"></a>4.4.3.1 实体的描述配置@ApiModel</h5><p>@ApiModel用于描述实体类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;添加评论dto&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddCommentDto</span>&#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-4-3-2-实体的属性的描述配置-ApiModelProperty"><a href="#4-4-3-2-实体的属性的描述配置-ApiModelProperty" class="headerlink" title="4.4.3.2 实体的属性的描述配置@ApiModelProperty"></a>4.4.3.2 实体的属性的描述配置@ApiModelProperty</h5><p>@ApiModelProperty用于描述实体的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(notes = &quot;评论类型（0代表文章评论，1代表友链评论）&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String type;</span><br></pre></td></tr></table></figure>







<h4 id="4-4-4-文档信息配置"><a href="#4-4-4-文档信息配置" class="headerlink" title="4.4.4 文档信息配置"></a>4.4.4 文档信息配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">customDocket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sangeng.controller&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;团队名&quot;</span>, <span class="string">&quot;http://www.my.com&quot;</span>, <span class="string">&quot;my@my.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;文档标题&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;文档描述&quot;</span>)</span><br><span class="line">                .contact(contact)   <span class="comment">// 联系方式</span></span><br><span class="line">                .version(<span class="string">&quot;1.1.0&quot;</span>)  <span class="comment">// 版本</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-博客后台"><a href="#5-博客后台" class="headerlink" title="5.博客后台"></a>5.博客后台</h2><h3 id="5-0准备工作"><a href="#5-0准备工作" class="headerlink" title="5.0准备工作"></a>5.0准备工作</h3><p>前端工程启动，npm install   </p>
<p>因为node版本过高，所以重新配置了启动命令 npm run dev_t</p>
<p>①创建启动类</p>
<p><img src="/2023/05/29/blog/image-20230624100245122.png" alt="image-20230624100245122"></p>
<p>②创建application.yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8989</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/sg_blog?characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">111111</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">2MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">5MB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">delFlag</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>

<p>③ SQL语句</p>
<p>④ 创建实体类，Mapper，Service </p>
<p>依旧放在framework里面</p>
<h4 id="5-1-0Tag标签列表测试"><a href="#5-1-0Tag标签列表测试" class="headerlink" title="5.1.0Tag标签列表测试"></a>5.1.0Tag标签列表测试</h4><p>Tagcontroller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/content/tag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TagService tagService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(tagService.list());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tag</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_tag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tag</span>  &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line">    <span class="comment">//备注</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">    <span class="comment">//标签名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>TagMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 标签(Tag)表数据库访问层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022-07-19 22:33:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TagMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Tag&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>TagService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 标签(Tag)表服务接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022-07-19 22:33:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TagService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Tag&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>TagServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 标签(Tag)表服务实现类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022-07-19 22:33:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;tagService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;TagMapper, Tag&gt; <span class="keyword">implements</span> <span class="title class_">TagService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置Security类，只在测试的时候开放所有请求都不需要认证</p>
<p><img src="/2023/05/29/blog/image-20230624101212237.png" alt="image-20230624101212237"></p>
<p>引入JwtAuthenticationTokenFilter</p>
<p>此处用postman测试，我这里因为已经写好了登录功能所以在浏览器测试了一下</p>
<p><img src="/2023/05/29/blog/image-20230624101401923.png" alt="image-20230624101401923"></p>
<h3 id="5-1后台登录"><a href="#5-1后台登录" class="headerlink" title="5.1后台登录"></a>5.1后台登录</h3><h4 id="5-1-1-接口设计"><a href="#5-1-1-接口设计" class="headerlink" title="5.1.1 接口设计"></a>5.1.1 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;user&#x2F;login</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;1234&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0ODBmOThmYmJkNmI0NjM0OWUyZjY2NTM0NGNjZWY2NSIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY0Mzg3NDMxNiwiZXhwIjoxNjQzOTYwNzE2fQ.ldLBUvNIxQCGemkCoMgT_0YsjsWndTg5tqfJb77pabk&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-思路分析"><a href="#5-1-2-思路分析" class="headerlink" title="5.1.2 思路分析"></a>5.1.2 思路分析</h4><p>登录</p>
<p>​	①自定义登录接口  </p>
<p>​				调用ProviderManager的方法进行认证 如果认证通过生成jwt</p>
<p>​				把用户信息存入redis中</p>
<p>​	②自定义UserDetailsService </p>
<p>​				在这个实现类中去查询数据库</p>
<p>​	注意配置passwordEncoder为BCryptPasswordEncoder</p>
<p>校验：</p>
<p>​	①定义Jwt认证过滤器</p>
<p>​				获取token</p>
<p>​				解析token获取其中的userid</p>
<p>​				从redis中获取用户信息</p>
<p>​				存入SecurityContextHolder</p>
<h4 id="5-1-3-准备工作"><a href="#5-1-3-准备工作" class="headerlink" title="5.1.3 准备工作"></a>5.1.3 准备工作</h4><p>①添加依赖</p>
<p>前面已经添加过相关依赖，不需要做什么处理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--fastjson依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--jwt依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h4 id="5-1-4-登录接口代码实现"><a href="#5-1-4-登录接口代码实现" class="headerlink" title="5.1.4 登录接口代码实现"></a>5.1.4 登录接口代码实现</h4><h5 id="LoginController"><a href="#LoginController" class="headerlink" title="LoginController"></a>LoginController</h5><p>复制一份BlogLoginController ，命名为LoginController，其中注入 LoginService </p>
<p>请求地址修改为&#x2F;user&#x2F;login即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">            <span class="comment">//提示 必须要传用户名</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.REQUIRE_USERNAME);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> loginService.login(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="LoginService"><a href="#LoginService" class="headerlink" title="LoginService"></a>LoginService</h5><p>复制一份BlogLoginService命名为LoginService即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line">    ResponseResult <span class="title function_">login</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="SecurityConfig"><a href="#SecurityConfig" class="headerlink" title="SecurityConfig"></a>SecurityConfig</h5><p>之前已经复制过了</p>
<h5 id="SystemLoginServiceImpl"><a href="#SystemLoginServiceImpl" class="headerlink" title="SystemLoginServiceImpl"></a>SystemLoginServiceImpl</h5><p>复制一份，LoginServiceImpl，命名为SystemLoginServiceImpl  实现 LoginService</p>
<p>login方法中存redis的key的前缀修改为login</p>
<p>返回的数据中只要返回token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(),user.getPassword());</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationManager.authenticate(authenticationToken);</span><br><span class="line">        <span class="comment">//判断是否认证通过</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(authenticate))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取userid 生成token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line">        <span class="comment">//把用户信息存入redis</span></span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;login:&quot;</span>+userId,loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把token封装 返回</span></span><br><span class="line">		Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;token&quot;</span>,jwt);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="UserDetailServiceImpl"><a href="#UserDetailServiceImpl" class="headerlink" title="UserDetailServiceImpl"></a>UserDetailServiceImpl</h5><p>复用原来的即可</p>
<h5 id="LoginUser"><a href="#LoginUser" class="headerlink" title="LoginUser"></a>LoginUser</h5><p>复用原来的即可</p>
<h3 id="5-2-后台权限控制及动态路由"><a href="#5-2-后台权限控制及动态路由" class="headerlink" title="5.2 后台权限控制及动态路由"></a>5.2 后台权限控制及动态路由</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>​	后台系统需要能实现不同的用户权限可以看到不同的功能。</p>
<p>​    用户只能使用他的权限所允许使用的功能。</p>
<h4 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h4><p>​	之前在我的SpringSecurity的课程中就介绍过RBAC权限模型。没有学习过的可以去看下 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mm4y1X7Hc?p=28">RBAC权限模型</a>  。这里我们就是在RBAC权限模型的基础上去实现这个功能。</p>
<p>​	</p>
<h4 id="表分析"><a href="#表分析" class="headerlink" title="表分析"></a>表分析</h4><p>​	通过需求去分析需要有哪些字段。</p>
<h4 id="5-2-1接口设计"><a href="#5-2-1接口设计" class="headerlink" title="5.2.1接口设计"></a>5.2.1接口设计</h4><h5 id="getInfo接口"><a href="#getInfo接口" class="headerlink" title="getInfo接口"></a>getInfo接口</h5><p>是</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;getInfo</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数	：</p>
<p>无</p>
<p>响应格式:</p>
<p>如果用户id为1代表管理员，roles 中只需要有admin，permissions中需要有所有菜单类型为C或者F的，状态为正常的，未被删除的权限</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;system:role:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:menu:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:user:query&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:user:add&quot;</span></span><br><span class="line">            <span class="comment">//此次省略1000字</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;admin&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://r7yxkqloa.bkt.clouddn.com/2022/03/05/75fd15587811443a9a9a771f24da458d.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg3334&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="getInfo接口实现"><a href="#getInfo接口实现" class="headerlink" title="getInfo接口实现"></a>getInfo接口实现</h5><h6 id="Controller层"><a href="#Controller层" class="headerlink" title="Controller层"></a>Controller层</h6><p><img src="/2023/05/29/blog/image-20230624101950411.png" alt="image-20230624101950411"></p>
<h6 id="查权限"><a href="#查权限" class="headerlink" title="查权限"></a>查权限</h6><p>MenuServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单权限表(Menu)表服务实现类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-06-21 18:05:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;menuService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MenuMapper, Menu&gt; <span class="keyword">implements</span> <span class="title class_">MenuService</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MenuMapper menuMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectPermsByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//如果是管理员则返回所有权限</span></span><br><span class="line">        <span class="keyword">if</span>(id==<span class="number">1L</span>)&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;Menu&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            lqw.in(Menu::getMenuType,SystemConstants.MENU,SystemConstants.BUTTON);</span><br><span class="line">            lqw.eq(Menu::getStatus,SystemConstants.STATUS_NORMAL);</span><br><span class="line">            List&lt;Menu&gt; menuList = list(lqw);</span><br><span class="line">            List&lt;String&gt; perms = menuList.stream()</span><br><span class="line">                    .map(Menu::getPerms)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">return</span> perms;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则返回用户所具有的权限信息</span></span><br><span class="line">        <span class="keyword">return</span> menuMapper.selectPermsByUserId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MenuMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单权限表(Menu)表数据库访问层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-06-21 18:05:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Menu&gt; &#123;</span><br><span class="line">    List&lt;String&gt; <span class="title function_">selectPermsByUserId</span><span class="params">(Long id)</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>MenuMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pure.mapper.MenuMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPermsByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT m.perms</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">                LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;id&#125; AND</span><br><span class="line">            m.`menu_type` IN (&#x27;C&#x27;,&#x27;F&#x27;) AND</span><br><span class="line">            m.`status` = 0 AND</span><br><span class="line">            m.`del_flag` = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="查角色"><a href="#查角色" class="headerlink" title="查角色"></a>查角色</h6><p>RoleServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;roleService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleMapper, Role&gt; <span class="keyword">implements</span> <span class="title class_">RoleService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectRoleKeyByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//如果是管理员，返回集合中只需要有admin</span></span><br><span class="line">        <span class="keyword">if</span>(id==<span class="number">1L</span>)&#123;</span><br><span class="line">            List&lt;String&gt; roleKeys=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            roleKeys.add(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> roleKeys;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则查询用户所具有的角色信息</span></span><br><span class="line">        <span class="keyword">return</span> roleMapper.selectRoleKeyByUserId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RoleMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Role&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; <span class="title function_">selectRoleKeyByUserId</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RoleMapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.pure.mapper.RoleMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectRoleKeyByUserId&quot;</span> resultType=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span><br><span class="line">        select</span><br><span class="line">            r.role_key</span><br><span class="line">        from</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role` r on  ur.role_id=r.id</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;id&#125; AND</span><br><span class="line">            r.`status` = <span class="number">0</span> AND</span><br><span class="line">            r.`del_flag` = <span class="number">0</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>获取用户信息</p>
<p>UserInfoVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后封装</p>
<p> AdminUserInfoVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminUserInfoVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; permissions;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; roles;</span><br><span class="line">    <span class="keyword">private</span> UserInfoVo user;</span><br></pre></td></tr></table></figure>

<h4 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h4><p>点击登录后发送请求getInfo</p>
<p><img src="/2023/05/29/blog/image-20230624103437788.png" alt="image-20230624103437788"></p>
<h4 id="5-2-2接口设计"><a href="#5-2-2接口设计" class="headerlink" title="5.2.2接口设计"></a>5.2.2接口设计</h4><h5 id="getRouters接口"><a href="#getRouters接口" class="headerlink" title="getRouters接口"></a>getRouters接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;getRouters</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数：</p>
<p>无</p>
<p>响应格式:</p>
<p>​	前端为了实现动态路由的效果，需要后端有接口能返回用户所能访问的菜单数据。</p>
<p>​	注意：<strong>返回的菜单数据需要体现父子菜单的层级关系</strong></p>
<p>​	如果用户id为1代表管理员，menus中需要有所有菜单类型为C或者M的，状态为正常的，未被删除的权限</p>
<p>​	数据格式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;menus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;content/article/write/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-08 11:39:58&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;write&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;content:article:writer&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/user/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/role/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;peoples&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;role&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:role:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/menu/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;tree-table&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">102</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;menu&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:menu:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="getRouters接口实现"><a href="#getRouters接口实现" class="headerlink" title="getRouters接口实现"></a>getRouters接口实现</h5><h6 id="Controller层-1"><a href="#Controller层-1" class="headerlink" title="Controller层"></a>Controller层</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/getRouters&quot;)</span></span><br><span class="line">     <span class="keyword">public</span> ResponseResult&lt;RoutersVo&gt; <span class="title function_">getRouters</span><span class="params">()</span>&#123;</span><br><span class="line">          Long userId=SecurityUtils.getUserId();</span><br><span class="line">          <span class="comment">//查询menu</span></span><br><span class="line">         List&lt;Menu&gt; menus=menuService.selectRouterMenuTreeByUserId(userId);</span><br><span class="line">         <span class="comment">//封装数据返回</span></span><br><span class="line">         <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">RoutersVo</span>(menus));</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<h6 id="MenuServiceImpl"><a href="#MenuServiceImpl" class="headerlink" title="MenuServiceImpl"></a>MenuServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectRouterMenuTreeByUserId</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">       <span class="comment">//判断是否是管理员,则返回所有菜单</span></span><br><span class="line">       List&lt;Menu&gt; menus = <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span>(userId==<span class="number">1L</span>)&#123;</span><br><span class="line">           <span class="comment">//如果是 获取所有符合要求的Menu</span></span><br><span class="line">           menus = menuMapper.selectAllRouterMenu();</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="comment">//否则  获取当前用户所具有的Menu</span></span><br><span class="line">          menus = menuMapper.selectRouterMenuTreeByUserId(userId);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//构建tree</span></span><br><span class="line">       <span class="comment">//先找出第一层的菜单  然后去找他们的子菜单设置到children属性中</span></span><br><span class="line">       List&lt;Menu&gt; menuTree = builderMenuTree(menus,<span class="number">0L</span>);</span><br><span class="line">       <span class="keyword">return</span> menuTree;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;Menu&gt;  <span class="title function_">builderMenuTree</span><span class="params">(List&lt;Menu&gt; menus,Long parentId)</span>&#123;</span><br><span class="line">       List&lt;Menu&gt; menuTree = menus.stream()</span><br><span class="line">               .filter(menu -&gt; menu.getParentId().equals(parentId))</span><br><span class="line">               .map(menu -&gt; menu.setChildren(getChildren(menu, menus)))</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">       <span class="keyword">return</span> menuTree;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">getChildren</span><span class="params">(Menu menu, List&lt;Menu&gt; menus)</span> &#123;</span><br><span class="line">       List&lt;Menu&gt; childrenList = menus.stream()</span><br><span class="line">               .filter(menu1 -&gt; menu1.getParentId().equals(menu.getId()))</span><br><span class="line">               .map(menu1 -&gt; menu1.setChildren(getChildren(menu1, menus)))</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">       <span class="keyword">return</span> childrenList;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>MenuMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Menu&gt; &#123;</span><br><span class="line"> List&lt;Menu&gt; <span class="title function_">selectAllRouterMenu</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Menu&gt; <span class="title function_">selectRouterMenuTreeByUserId</span><span class="params">(Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="MenuMapper-xml"><a href="#MenuMapper-xml" class="headerlink" title="MenuMapper.xml"></a>MenuMapper.xml</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pure.mapper.MenuMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRouterMenu&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.pure.domin.entity.Menu&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT m.id, m.parent_id, m.menu_name, m.path, m.component, m.visible, m.status, IFNULL(m.perms,&#x27;&#x27;) AS perms, m.is_frame,  m.menu_type, m.icon, m.order_num, m.create_time</span><br><span class="line">        FROM</span><br><span class="line">            `sys_menu` m</span><br><span class="line">        WHERE</span><br><span class="line">            m.`menu_type` IN (&#x27;C&#x27;,&#x27;M&#x27;) AND</span><br><span class="line">            m.`status` = 0 AND</span><br><span class="line">            m.`del_flag` = 0</span><br><span class="line">        ORDER BY</span><br><span class="line">            m.parent_id,m.order_num</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRouterMenuTreeByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.pure.domin.entity.Menu&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT m.id, m.parent_id, m.menu_name, m.path, m.component, m.visible, m.status, IFNULL(m.perms,&#x27;&#x27;) AS perms, m.is_frame,  m.menu_type, m.icon, m.order_num, m.create_time</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">                LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;userId&#125; AND</span><br><span class="line">            m.`menu_type` IN (&#x27;C&#x27;,&#x27;M&#x27;) AND</span><br><span class="line">            m.`status` = 0 AND</span><br><span class="line">            m.`del_flag` = 0</span><br><span class="line">        ORDER BY</span><br><span class="line">            m.parent_id,m.order_num</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查询的列：</p>
<p>SELECT DISTINCT m.id, m.parent_id, m.menu_name, m.path, m.component, m.visible, m.status, IFNULL(m.perms,’’) AS perms, m.is_frame,  m.menu_type, m.icon, m.order_num, m.create_time</p>
<p>注意需要按照parent_id和order_num排序</p>
<h3 id="5-3-退出登录接口"><a href="#5-3-退出登录接口" class="headerlink" title="5.3 退出登录接口"></a>5.3 退出登录接口</h3><h4 id="5-3-1-接口设计"><a href="#5-3-1-接口设计" class="headerlink" title="5.3.1 接口设计"></a>5.3.1 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;user&#x2F;logout</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-3-2-代码实现"><a href="#5-3-2-代码实现" class="headerlink" title="5.3.2 代码实现"></a>5.3.2 代码实现</h4><p>要实现的操作：</p>
<p>​	删除redis中的用户信息</p>
<p>LoginController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/user/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> loginServcie.logout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseResult <span class="title function_">logout</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>SystemLoginServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前登录的用户id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId();</span><br><span class="line">    <span class="comment">//删除redis中对应的值</span></span><br><span class="line">    redisCache.deleteObject(<span class="string">&quot;login:&quot;</span>+userId);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityConfig</p>
<p>要关闭默认的退出登录功能。并且要配置我们的退出登录接口需要认证才能访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// 对于登录接口 允许匿名访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line"><span class="comment">//                //注销接口需要认证才能访问</span></span><br><span class="line"><span class="comment">//                .antMatchers(&quot;/logout&quot;).authenticated()</span></span><br><span class="line"><span class="comment">//                .antMatchers(&quot;/user/userInfo&quot;).authenticated()</span></span><br><span class="line"><span class="comment">//                .antMatchers(&quot;/upload&quot;).authenticated()</span></span><br><span class="line">                <span class="comment">// 除上面外的所有请求全部不需要认证即可访问</span></span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置异常处理器</span></span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">                .accessDeniedHandler(accessDeniedHandler);</span><br><span class="line">        <span class="comment">//关闭默认的注销功能</span></span><br><span class="line">        http.logout().disable();</span><br><span class="line">        <span class="comment">//把jwtAuthenticationTokenFilter添加到SpringSecurity的过滤器链中</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        <span class="comment">//允许跨域</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-查询标签列表"><a href="#5-4-查询标签列表" class="headerlink" title="5.4 查询标签列表"></a>5.4 查询标签列表</h3><h4 id="5-4-0-需求"><a href="#5-4-0-需求" class="headerlink" title="5.4.0 需求"></a>5.4.0 需求</h4><p>​	为了方便后期对文章进行管理，需要提供标签的功能，一个文章可以有多个标签。</p>
<p>​    在后台需要分页查询标签功能，要求能根据标签名进行分页查询。 <strong>后期可能会增加备注查询等需求</strong>。</p>
<p>​	注意：不能把删除了的标签查询出来。</p>
<h4 id="5-4-1-标签表分析"><a href="#5-4-1-标签表分析" class="headerlink" title="5.4.1 标签表分析"></a>5.4.1 标签表分析</h4><p>​	通过需求去分析需要有哪些字段。</p>
<h4 id="5-4-2-接口设计"><a href="#5-4-2-接口设计" class="headerlink" title="5.4.2 接口设计"></a>5.4.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>content&#x2F;tag&#x2F;list</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>name：标签名</p>
<p>remark：备注</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Java&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;sdad&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-4-3-代码实现"><a href="#5-4-3-代码实现" class="headerlink" title="5.4.3 代码实现"></a>5.4.3 代码实现</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/content/tag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TagService tagService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> ResponseResult <span class="title function_">tagList</span><span class="params">(Integer pageNum, Integer pageSize, TagListDto tagListDto)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> tagService.pageTagList(pageNum,pageSize,tagListDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TagListDto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagListDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TagService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TagService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Tag&gt; &#123;</span><br><span class="line"></span><br><span class="line">    ResponseResult&lt;PageVo&gt; <span class="title function_">pageTagList</span><span class="params">(Integer pageNum, Integer pageSize, TagListDto tagListDto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TagServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;tagService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;TagMapper, Tag&gt; <span class="keyword">implements</span> <span class="title class_">TagService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">pageTagList</span><span class="params">(Integer pageNum, Integer pageSize, TagListDto tagListDto)</span> &#123;</span><br><span class="line">        <span class="comment">//分页查询</span></span><br><span class="line">        LambdaQueryWrapper&lt;Tag&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lqw.eq(StringUtils.hasText(tagListDto.getName()),Tag::getName,tagListDto.getName());</span><br><span class="line">        lqw.eq(StringUtils.hasText(tagListDto.getRemark()),Tag::getRemark,tagListDto.getRemark());</span><br><span class="line"></span><br><span class="line">        Page&lt;Tag&gt; page =<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page(page,lqw);</span><br><span class="line">        <span class="comment">//封装数据返回</span></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">PageVo</span>(page.getRecords(),page.getTotal());</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-新增标签"><a href="#5-5-新增标签" class="headerlink" title="5.5 新增标签"></a>5.5 新增标签</h3><h4 id="5-5-0-需求"><a href="#5-5-0-需求" class="headerlink" title="5.5.0 需求"></a>5.5.0 需求</h4><p>​	点击标签管理的新增按钮可以实现新增标签的功能。</p>
<h4 id="5-5-1-接口设计"><a href="#5-5-1-接口设计" class="headerlink" title="5.5.1 接口设计"></a>5.5.1 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;content&#x2F;tag</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求体格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;c#&quot;</span><span class="punctuation">,</span><span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;c++++&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-5-2-测试"><a href="#5-5-2-测试" class="headerlink" title="5.5.2 测试"></a>5.5.2 测试</h4><p>测试时注意，添加到数据库中的记录有没有 创建时间，更新时间，创建人，更新人字段。</p>
<h3 id="5-6-删除标签"><a href="#5-6-删除标签" class="headerlink" title="5.6 删除标签"></a>5.6 删除标签</h3><h4 id="5-6-1-接口设计"><a href="#5-6-1-接口设计" class="headerlink" title="5.6.1 接口设计"></a>5.6.1 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>&#x2F;content&#x2F;tag&#x2F;{id}</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数在path中</p>
<p>例如：content&#x2F;tag&#x2F;6   代表删除id为6的标签数据</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-6-2-测试"><a href="#5-6-2-测试" class="headerlink" title="5.6.2 测试"></a>5.6.2 测试</h4><p>注意测试删除后在列表中是否查看不到该条数据</p>
<p>数据库中该条数据还是存在的，只是修改了逻辑删除字段的值</p>
<h3 id="5-7-修改标签"><a href="#5-7-修改标签" class="headerlink" title="5.7 修改标签"></a>5.7 修改标签</h3><h4 id="5-7-1-接口设计"><a href="#5-7-1-接口设计" class="headerlink" title="5.7.1 接口设计"></a>5.7.1 接口设计</h4><h5 id="5-7-1-1-获取标签信息"><a href="#5-7-1-1-获取标签信息" class="headerlink" title="5.7.1.1 获取标签信息"></a>5.7.1.1 获取标签信息</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;content&#x2F;tag&#x2F;{id}</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数在path中</p>
<p>例如：content&#x2F;tag&#x2F;6   代表获取id为6的标签数据</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Java&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;sdad&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="5-7-1-2-修改标签接口"><a href="#5-7-1-2-修改标签接口" class="headerlink" title="5.7.1.2 修改标签接口"></a>5.7.1.2 修改标签接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;content&#x2F;tag</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求体格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;c#&quot;</span><span class="punctuation">,</span><span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;c++++&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-8-写博文"><a href="#5-8-写博文" class="headerlink" title="5.8 写博文"></a>5.8 写博文</h3><h4 id="5-8-1-需求"><a href="#5-8-1-需求" class="headerlink" title="5.8.1 需求"></a>5.8.1 需求</h4><p>​	需要提供写博文的功能，写博文时需要关联分类和标签。</p>
<p>​	可以上传缩略图，也可以在正文中添加图片。</p>
<p>​	文章可以直接发布，也可以保存到草稿箱。</p>
<h4 id="5-8-2-表分析"><a href="#5-8-2-表分析" class="headerlink" title="5.8.2 表分析"></a>5.8.2 表分析</h4><p>​	标签和文章需要关联所以需要一张关联表。</p>
<p>​	SQL脚本：SGBlog\资源\SQL\sg_article_tag.sql</p>
<h4 id="5-8-2-接口设计"><a href="#5-8-2-接口设计" class="headerlink" title="5.8.2 接口设计"></a>5.8.2 接口设计</h4><p>​	思考下需要哪些接口才能实现这个功能？</p>
<h5 id="5-8-2-1-查询所有分类接口"><a href="#5-8-2-1-查询所有分类接口" class="headerlink" title="5.8.2.1 查询所有分类接口"></a>5.8.2.1 查询所有分类接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;content&#x2F;category&#x2F;listAllCategory</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数：</p>
<p>​	无</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;wsd&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;java&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;wsd&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;PHP&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="5-8-2-2-查询所有标签接口"><a href="#5-8-2-2-查询所有标签接口" class="headerlink" title="5.8.2.2 查询所有标签接口"></a>5.8.2.2 查询所有标签接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;content&#x2F;tag&#x2F;listAllTag</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数:</p>
<p>​	无</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Mybatis&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Java&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>哎哟，这里懒得封装vo了，反正正常能正常在前端展示，因为前端只要了name字段</p>
<h5 id="5-8-2-3-上传图片"><a href="#5-8-2-3-上传图片" class="headerlink" title="5.8.2.3 上传图片"></a>5.8.2.3 上传图片</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;upload</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>参数：</p>
<p>​	img,值为要上传的文件</p>
<p>请求头：</p>
<p>​	Content-Type ：multipart&#x2F;form-data;</p>
<p>响应格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文件访问链接&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="5-8-2-4-新增博文"><a href="#5-8-2-4-新增博文" class="headerlink" title="5.8.2.4 新增博文"></a>5.8.2.4 新增博文</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;content&#x2F;article</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求体格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;测试新增博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thumbnail&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/08/21/4ceebc07e7484beba732f12b0d2c43a9.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isTop&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;# 一级标题\n## 二级标题\n![Snipaste_20220228_224837.png](https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/08/21/c3af554d4a0f4935b4073533a4c26ee8.png)\n正文&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">4</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span><span class="string">&quot;哈哈&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-8-3-代码实现"><a href="#5-8-3-代码实现" class="headerlink" title="5.8.3 代码实现"></a>5.8.3 代码实现</h4><h5 id="5-8-3-1-查询所有分类接口"><a href="#5-8-3-1-查询所有分类接口" class="headerlink" title="5.8.3.1 查询所有分类接口"></a>5.8.3.1 查询所有分类接口</h5><p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 三更  B站： https://space.bilibili.com/663528522</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/content/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/listAllCategory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">listAllCategory</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;CategoryVo&gt; list = categoryService.listAllCategory();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>CategoryVo修改,增加description属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//描述</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryService增加listAllCategory方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;CategoryVo&gt; <span class="title function_">listAllCategory</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SystemConstants中增加常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 正常状态 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL</span> <span class="operator">=</span> <span class="string">&quot;0&quot;</span>;</span><br></pre></td></tr></table></figure>





<p>CategoryServiceImpl增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryVo&gt; <span class="title function_">listAllCategory</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(Category::getStatus, SystemConstants.NORMAL);</span><br><span class="line">    List&lt;Category&gt; list = list(wrapper);</span><br><span class="line">    List&lt;CategoryVo&gt; categoryVos = BeanCopyUtils.copyBeanList(list, CategoryVo.class);</span><br><span class="line">    <span class="keyword">return</span> categoryVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="5-8-3-2-查询所有标签接口"><a href="#5-8-3-2-查询所有标签接口" class="headerlink" title="5.8.3.2 查询所有标签接口"></a>5.8.3.2 查询所有标签接口</h5><p>TagVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TagVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//标签名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>TagController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/listAllTag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">listAllTag</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;TagVo&gt; list = tagService.listAllTag();</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>TagService 增加listAllTag方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TagVo&gt; <span class="title function_">listAllTag</span><span class="params">()</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>TagServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TagVo&gt; <span class="title function_">listAllTag</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Tag&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.select(Tag::getId,Tag::getName);</span><br><span class="line">    List&lt;Tag&gt; list = list(wrapper);</span><br><span class="line">    List&lt;TagVo&gt; tagVos = BeanCopyUtils.copyBeanList(list, TagVo.class);</span><br><span class="line">    <span class="keyword">return</span> tagVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="5-8-3-3-上传图片接口"><a href="#5-8-3-3-上传图片接口" class="headerlink" title="5.8.3.3 上传图片接口"></a>5.8.3.3 上传图片接口</h5><p>在sangeng-admin中增加UploadController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 三更  B站： https://space.bilibili.com/663528522</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadService uploadService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImg</span><span class="params">(<span class="meta">@RequestParam(&quot;img&quot;)</span> MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> uploadService.uploadImg(multipartFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件上传上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="5-8-3-4-新增博文接口"><a href="#5-8-3-4-新增博文接口" class="headerlink" title="5.8.3.4 新增博文接口"></a>5.8.3.4 新增博文接口</h5><p>ArticleController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 三更  B站： https://space.bilibili.com/663528522</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/content/article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> AddArticleDto article)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.add(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AddArticleDto</p>
<p>注意增加tags属性用于接收文章关联标签的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddArticleDto</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; tags;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<p>Article 修改这样创建时间创建人修改时间修改人可以自动填充</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createBy;</span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateBy;</span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure>





<p>ArticleService增加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseResult <span class="title function_">add</span><span class="params">(AddArticleDto article)</span>;</span><br></pre></td></tr></table></figure>



<p>创建ArticleTag表相关的实体类，mapper，service,serviceimpl等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(value=&quot;sg_article_tag&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleTag</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">625337492348897098L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 文章id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 标签id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Long tagId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>ArticleServiceImpl增加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ArticleTagService articleTagService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(AddArticleDto articleDto)</span> &#123;</span><br><span class="line">    <span class="comment">//添加 博客</span></span><br><span class="line">    <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> BeanCopyUtils.copyBean(articleDto, Article.class);</span><br><span class="line">    save(article);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;ArticleTag&gt; articleTags = articleDto.getTags().stream()</span><br><span class="line">            .map(tagId -&gt; <span class="keyword">new</span> <span class="title class_">ArticleTag</span>(article.getId(), tagId))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加 博客和标签的关联</span></span><br><span class="line">    articleTagService.saveBatch(articleTags);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-9-导出所有分类到Excel"><a href="#5-9-导出所有分类到Excel" class="headerlink" title="5.9 导出所有分类到Excel"></a>5.9 导出所有分类到Excel</h3><h4 id="5-9-1-需求"><a href="#5-9-1-需求" class="headerlink" title="5.9.1 需求"></a>5.9.1 需求</h4><p>​	在分类管理中点击导出按钮可以把所有的分类导出到Excel文件中。</p>
<p>​	</p>
<h4 id="5-9-2-技术方案"><a href="#5-9-2-技术方案" class="headerlink" title="5.9.2 技术方案"></a>5.9.2 技术方案</h4><p>​	使用EasyExcel实现Excel的导出操作。</p>
<p>​	<a target="_blank" rel="noopener" href="https://github.com/alibaba/easyexcel">https://github.com/alibaba/easyexcel</a></p>
<p>​    <a target="_blank" rel="noopener" href="https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1">https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1</a></p>
<h4 id="5-9-3-接口设计"><a href="#5-9-3-接口设计" class="headerlink" title="5.9.3 接口设计"></a>5.9.3 接口设计</h4><p>​	</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;content&#x2F;category&#x2F;export</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>请求参数：</p>
<p>​	无</p>
<p>响应格式：</p>
<p>成功的话可以直接导出一个Excel文件</p>
<p>失败的话响应格式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;出现错误&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-9-4-代码实现"><a href="#5-9-4-代码实现" class="headerlink" title="5.9.4 代码实现"></a>5.9.4 代码实现</h4><p>工具类方法修改</p>
<p>WebUtils</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDownLoadHeader</span><span class="params">(String filename, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    response.setContentType(<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);</span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    String fname= URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>).replaceAll(<span class="string">&quot;\\+&quot;</span>, <span class="string">&quot;%20&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>,<span class="string">&quot;attachment; filename=&quot;</span>+fname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//设置下载文件的请求头</span></span><br><span class="line">        WebUtils.setDownLoadHeader(<span class="string">&quot;分类.xlsx&quot;</span>,response);</span><br><span class="line">        <span class="comment">//获取需要导出的数据</span></span><br><span class="line">        List&lt;Category&gt; categoryVos = categoryService.list();</span><br><span class="line"></span><br><span class="line">        List&lt;ExcelCategoryVo&gt; excelCategoryVos = BeanCopyUtils.copyBeanList(categoryVos, ExcelCategoryVo.class);</span><br><span class="line">        <span class="comment">//把数据写入到Excel中</span></span><br><span class="line">        EasyExcel.write(response.getOutputStream(), ExcelCategoryVo.class).autoCloseStream(Boolean.FALSE).sheet(<span class="string">&quot;分类导出&quot;</span>)</span><br><span class="line">                .doWrite(excelCategoryVos);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">//如果出现异常也要响应json</span></span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);</span><br><span class="line">        WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>ExcelCategoryVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelCategoryVo</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;分类名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//描述</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;描述&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态0:正常,1禁用</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;状态0:正常,1禁用&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-10-权限控制"><a href="#5-10-权限控制" class="headerlink" title="5.10 权限控制"></a>5.10 权限控制</h3><h4 id="5-10-1-需求"><a href="#5-10-1-需求" class="headerlink" title="5.10.1 需求"></a>5.10.1 需求</h4><p>​	需要对导出分类的接口做权限控制。</p>
<p>sg   eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJkZGJkNjM5MWJiZTA0NmMzOTc4NDg1ZTcxNWQ3YjQ0MSIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY2MjI0NDE4NywiZXhwIjoxNjYyMzMwNTg3fQ.z4JGwFN3lWyVbOCbhikCe-O4D6SvCQFEE5eQY3jDJkw</p>
<p>sangeng</p>
<p>eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0Y2I1ZjhmMTc0Mjk0NzM0YjI4Y2M1NTQzYjQ2Yjc1YyIsInN1YiI6IjYiLCJpc3MiOiJzZyIsImlhdCI6MTY2MjI0NDQzMywiZXhwIjoxNjYyMzMwODMzfQ.yEkbyGYXBp5ndnyq-3acdgpvqx2mnI8B9fK9f3Y6Jco</p>
<h4 id="5-10-2-代码实现"><a href="#5-10-2-代码实现" class="headerlink" title="5.10.2 代码实现"></a>5.10.2 代码实现</h4><p>SecurityConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br></pre></td></tr></table></figure>





<p>UserDetailsServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="comment">//根据用户名查询用户信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getUserName,username);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(queryWrapper);</span><br><span class="line">        <span class="comment">//判断是否查到用户  如果没查到抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(user))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回用户信息</span></span><br><span class="line">        <span class="keyword">if</span>(user.getType().equals(SystemConstants.ADMAIN))&#123;</span><br><span class="line">            List&lt;String&gt; list = menuMapper.selectPermsByUserId(user.getId());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user,list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>LoginUser</p>
<p>增加属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;String&gt; permissions;</span><br></pre></td></tr></table></figure>





<p>PermissionService</p>
<p>hasPermisson</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;ps&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断当前用户是否具有permission</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> permission 要判断的权限</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(String permission)</span>&#123;</span><br><span class="line">        <span class="comment">//如果是超级管理员  直接返回true</span></span><br><span class="line">        <span class="keyword">if</span>(SecurityUtils.isAdmin())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则  获取当前登录用户所具有的权限列表 如何判断是否存在permission</span></span><br><span class="line">        List&lt;String&gt; permissions = SecurityUtils.getLoginUser().getPermissions();</span><br><span class="line">        <span class="keyword">return</span> permissions.contains(permission);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;@ps.hasPermission(&#x27;content:category:export&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//设置下载文件的请求头</span></span><br><span class="line">        WebUtils.setDownLoadHeader(<span class="string">&quot;分类.xlsx&quot;</span>,response);</span><br><span class="line">        <span class="comment">//获取需要导出的数据</span></span><br><span class="line">        List&lt;Category&gt; categoryVos = categoryService.list();</span><br><span class="line"></span><br><span class="line">        List&lt;ExcelCategoryVo&gt; excelCategoryVos = BeanCopyUtils.copyBeanList(categoryVos, ExcelCategoryVo.class);</span><br><span class="line">        <span class="comment">//把数据写入到Excel中</span></span><br><span class="line">        EasyExcel.write(response.getOutputStream(), ExcelCategoryVo.class).autoCloseStream(Boolean.FALSE).sheet(<span class="string">&quot;分类导出&quot;</span>)</span><br><span class="line">                .doWrite(excelCategoryVos);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">//如果出现异常也要响应json</span></span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);</span><br><span class="line">        WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="5-11-文章列表"><a href="#5-11-文章列表" class="headerlink" title="5.11 文章列表"></a>5.11 文章列表</h3><h4 id="5-10-1-需求-1"><a href="#5-10-1-需求-1" class="headerlink" title="5.10.1 需求"></a>5.10.1 需求</h4><p>​	为了对文章进行管理，需要提供文章列表，</p>
<p>​    在后台需要分页查询文章功能，要求能根据标题和摘要<strong>模糊查询</strong>。 </p>
<p>​	注意：不能把删除了的文章查询出来</p>
<h4 id="5-10-2-接口设计"><a href="#5-10-2-接口设计" class="headerlink" title="5.10.2  接口设计"></a>5.10.2  接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>&#x2F;content&#x2F;article&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>title：文章标题</p>
<p>summary：文章摘要</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘻嘻嘻嘻嘻嘻&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-24 07:20:11&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;isTop&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span><span class="string">&quot;SpringSecurity框架教程-Spring Security+JWT实现项目级前端分离认证授权&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;thumbnail&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/01/31/948597e164614902ab1662ba8452e106.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;SpringSecurity从入门到精通&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;viewCount&quot;</span><span class="punctuation">:</span><span class="string">&quot;161&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>​	</p>
<h3 id="5-12-修改文章"><a href="#5-12-修改文章" class="headerlink" title="5.12 修改文章"></a>5.12 修改文章</h3><h4 id="5-12-1-需求"><a href="#5-12-1-需求" class="headerlink" title="5.12.1 需求"></a>5.12.1 需求</h4><p>​	点击文章列表中的修改按钮可以跳转到写博文页面。回显示该文章的具体信息。</p>
<p>​	用户可以在该页面修改文章信息。点击更新按钮后修改文章。</p>
<h4 id="5-12-2-分析"><a href="#5-12-2-分析" class="headerlink" title="5.12.2 分析"></a>5.12.2 分析</h4><p>​	这个功能的实现首先需要能够根据文章id查询文章的详细信息这样才能实现文章的回显。</p>
<p>​	如何需要提供更新文章的接口。</p>
<h4 id="5-12-3-接口设计"><a href="#5-12-3-接口设计" class="headerlink" title="5.12.3 接口设计"></a>5.12.3 接口设计</h4><h5 id="5-12-3-1-查询文章详情接口"><a href="#5-12-3-1-查询文章详情接口" class="headerlink" title="5.12.3.1 查询文章详情接口"></a>5.12.3.1 查询文章详情接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>content&#x2F;article&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 文章id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-08-28 15:15:46&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;10&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;isTop&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span><span class="string">&quot;啊实打实&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;5&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;thumbnail&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/08/28/7659aac2b74247fe8ebd9e054b916dbf.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;委屈饿驱蚊器&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-08-28 15:15:46&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;viewCount&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="5-12-3-2-更新文章接口"><a href="#5-12-3-2-更新文章接口" class="headerlink" title="5.12.3.2 更新文章接口"></a>5.12.3.2 更新文章接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>content&#x2F;article</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体参数格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;![Snipaste_20220228_224837.png](https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/08/28/f3938a0368c540ee909ba7f7079a829a.png)\n\n# 十大\n## 时代的&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-08-28 15:15:46&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;10&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isTop&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span><span class="string">&quot;啊实打实2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;5&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thumbnail&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://sg-blog-oss.oss-cn-beijing.aliyuncs.com/2022/08/28/7659aac2b74247fe8ebd9e054b916dbf.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;委屈饿驱蚊器&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-08-28 15:15:46&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;viewCount&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-13-删除文章"><a href="#5-13-删除文章" class="headerlink" title="5.13 删除文章"></a>5.13 删除文章</h3><h4 id="5-13-1-需求"><a href="#5-13-1-需求" class="headerlink" title="5.13.1 需求"></a>5.13.1 需求</h4><p>​	点击文章后面的删除按钮可以删除该文章</p>
<p>​	注意：是逻辑删除不是物理删除</p>
<h4 id="5-13-2-接口设计"><a href="#5-13-2-接口设计" class="headerlink" title="5.13.2 接口设计"></a>5.13.2 接口设计</h4><p>​	</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>content&#x2F;article&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path请求参数：</p>
<p>id：要删除的文章id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>







<h3 id="5-14-菜单列表"><a href="#5-14-菜单列表" class="headerlink" title="5.14 菜单列表"></a>5.14 菜单列表</h3><h4 id="5-14-1-需求"><a href="#5-14-1-需求" class="headerlink" title="5.14.1 需求"></a>5.14.1 需求</h4><p>​	需要展示菜单列表，不需要分页。</p>
<p>​	可以针对菜单名进行模糊查询</p>
<p>​	也可以针对菜单的状态进行查询。</p>
<p>​	菜单要按照父菜单id和orderNum进行排序</p>
<h4 id="5-14-2-接口设计"><a href="#5-14-2-接口设计" class="headerlink" title="5.14.2 接口设计"></a>5.14.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>system&#x2F;menu&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query请求参数：</p>
<p>status  : 状态</p>
<p>menuName： 菜单名</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			.<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;content/article/write/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;isFrame&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;write&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;content:article:writer&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			.<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;isFrame&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理目录&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;table&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;isFrame&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;content&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/user/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;isFrame&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理菜单&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult&lt;List&lt;AdminMenuVo&gt;&gt; <span class="title function_">menuList</span><span class="params">(String menuName, String status)</span> &#123;</span><br><span class="line">     LambdaQueryWrapper&lt;Menu&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">     lqw.like(Objects.nonNull(menuName),Menu::getMenuName,<span class="string">&quot;%&quot;</span>+menuName+<span class="string">&quot;%&quot;</span>);</span><br><span class="line">     lqw.eq(Objects.nonNull(status),Menu::getStatus,status);</span><br><span class="line">     lqw.orderByDesc(Menu::getOrderNum);</span><br><span class="line">     List&lt;Menu&gt; menuList = list(lqw);</span><br><span class="line">     List&lt;AdminMenuVo&gt; adminMenuVos = BeanCopyUtils.copyBeanList(menuList, AdminMenuVo.class);</span><br><span class="line">     <span class="keyword">return</span> ResponseResult.okResult(adminMenuVos);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-15-新增菜单"><a href="#5-15-新增菜单" class="headerlink" title="5.15 新增菜单"></a>5.15 新增菜单</h3><h4 id="5-15-1-需求"><a href="#5-15-1-需求" class="headerlink" title="5.15.1 需求"></a>5.15.1 需求</h4><p>​	可以新增菜单</p>
<h4 id="5-15-2-接口设计"><a href="#5-15-2-接口设计" class="headerlink" title="5.15.2 接口设计"></a>5.15.2 接口设计</h4><p>​	</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>content&#x2F;article</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体参数：</p>
<p>​	Menu类对应的json格式</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">insertMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">    save(menu);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-16-修改菜单"><a href="#5-16-修改菜单" class="headerlink" title="5.16 修改菜单"></a>5.16 修改菜单</h3><h4 id="5-16-1-需求"><a href="#5-16-1-需求" class="headerlink" title="5.16.1 需求"></a>5.16.1 需求</h4><p>​	能够修改菜单，但是修改的时候不能把父菜单设置为当前菜单，如果设置了需要给出相应的提示。并且修改失败。</p>
<h4 id="5-16-2-接口设计"><a href="#5-16-2-接口设计" class="headerlink" title="5.16.2 接口设计"></a>5.16.2 接口设计</h4><h5 id="5-16-2-1-根据id查询菜单数据"><a href="#5-16-2-1-根据id查询菜单数据" class="headerlink" title="5.16.2.1 根据id查询菜单数据"></a>5.16.2.1 根据id查询菜单数据</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>system&#x2F;menu&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 菜单id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;table&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;content&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;AdminMenuVo&gt; <span class="title function_">updatMeun</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Menu</span> <span class="variable">menu</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="type">AdminMenuVo</span> <span class="variable">adminMenuVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(menu, AdminMenuVo.class);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(adminMenuVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="5-16-2-2-更新菜单"><a href="#5-16-2-2-更新菜单" class="headerlink" title="5.16.2.2 更新菜单"></a>5.16.2.2 更新菜单</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>system&#x2F;menu</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体参数：</p>
<p>​	Menu类对应的json格式</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果把父菜单设置为当前菜单:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">500</span>,</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;修改菜单&#x27;写博文&#x27;失败，上级菜单不能选择自己&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">saveMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">    <span class="comment">//最好用equals比较</span></span><br><span class="line">    <span class="keyword">if</span>(menu.getId()==menu.getParentId())&#123;</span><br><span class="line">        <span class="comment">//这里抛出的异常类型可以定义为常量，保存在AppHttpCodeEnum中</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(AppHttpCodeEnum.PARENT_MENU_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">    updateById(menu);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-17-删除菜单"><a href="#5-17-删除菜单" class="headerlink" title="5.17 删除菜单"></a>5.17 删除菜单</h3><h4 id="5-17-1-需求"><a href="#5-17-1-需求" class="headerlink" title="5.17.1 需求"></a>5.17.1 需求</h4><p>​	能够删除菜单，但是如果要删除的菜单有子菜单则提示：存在子菜单不允许删除 并且删除失败。</p>
<h4 id="5-17-2-接口设计"><a href="#5-17-2-接口设计" class="headerlink" title="5.17.2 接口设计"></a>5.17.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>content&#x2F;article&#x2F;{menuId}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path参数：</p>
<p>menuId：要删除菜单的id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果要删除的菜单有子菜单则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">500</span>,</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;存在子菜单不允许删除&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">deleteMenu</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">//判断是否有子菜单</span></span><br><span class="line">       LambdaQueryWrapper&lt;Menu&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       lqw.eq(Menu::getParentId,id);</span><br><span class="line">       <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> count(lqw);</span><br><span class="line">       <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(AppHttpCodeEnum.HAVE_SON_MENU);</span><br><span class="line">       &#125;</span><br><span class="line">       removeById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-18-角色列表"><a href="#5-18-角色列表" class="headerlink" title="5.18 角色列表"></a>5.18 角色列表</h3><h4 id="5-18-1-需求"><a href="#5-18-1-需求" class="headerlink" title="5.18.1 需求"></a>5.18.1 需求</h4><p>​	需要有角色列表分页查询的功能。</p>
<p>​	要求能够针对角色名称进行模糊查询。</p>
<p>​	要求能够针对状态进行查询。</p>
<p>​	要求按照role_sort进行升序排列。</p>
<h4 id="5-18-2-接口设计"><a href="#5-18-2-接口设计" class="headerlink" title="5.18.2 接口设计"></a>5.18.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>system&#x2F;role&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>roleName：角色名称</p>
<p>status：状态</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;12&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;link&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链审核员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-19-改变角色状态"><a href="#5-19-改变角色状态" class="headerlink" title="5.19 改变角色状态"></a>5.19 改变角色状态</h3><h4 id="5-19-1-需求"><a href="#5-19-1-需求" class="headerlink" title="5.19.1 需求"></a>5.19.1 需求</h4><p>​	要求能够修改角色的停启用状态</p>
<h4 id="5-19-2-接口设计"><a href="#5-19-2-接口设计" class="headerlink" title="5.19.2 接口设计"></a>5.19.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>system&#x2F;role&#x2F;changeStatus</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;roleId&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span><span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-20-新增角色！！"><a href="#5-20-新增角色！！" class="headerlink" title="5.20 新增角色！！"></a>5.20 新增角色！！</h3><h4 id="5-20-1-需求"><a href="#5-20-1-需求" class="headerlink" title="5.20.1 需求"></a>5.20.1 需求</h4><p>​	需要提供新增角色的功能。新增角色时能够直接设置角色所关联的菜单权限。</p>
<h4 id="5-20-2-接口设计"><a href="#5-20-2-接口设计" class="headerlink" title="5.20.2 接口设计"></a>5.20.2 接口设计</h4><h5 id="5-20-2-1-获取菜单树接口"><a href="#5-20-2-1-获取菜单树接口" class="headerlink" title="5.20.2.1 获取菜单树接口"></a>5.20.2.1 获取菜单树接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;system&#x2F;menu&#x2F;treeselect</td>
<td>是</td>
</tr>
</tbody></table>
<p>无需请求参数</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span>	</span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1002&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1004&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户删除&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1005&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户导出&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1006&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户导入&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1007&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;重置密码&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1008&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1009&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1010&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1011&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色删除&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1012&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色导出&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;101&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1013&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1014&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1015&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1016&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单删除&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;文章管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2028&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;导出分类&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2018&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2018&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;分类管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2024&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2026&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链删除&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2027&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;标签管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>新增角色的前端界面里，还需要同时可以修改角色对应的权限信息。权限信息的返回格式是tree的形式。</p>
<p>先封装一下这个返回树的结构：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuTreeVo</span> &#123;</span><br><span class="line">    <span class="comment">//菜单ID@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//父菜单ID</span></span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    <span class="comment">//菜单名称</span></span><br><span class="line">    <span class="keyword">private</span> String label;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;? <span class="keyword">extends</span> <span class="title class_">MenuTreeVo</span>&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult&lt;List&lt;MenuTreeVo&gt;&gt; <span class="title function_">treeselect</span><span class="params">()</span> &#123;</span><br><span class="line">       List&lt;Menu&gt; list = list();</span><br><span class="line">       List&lt;MenuTreeVo&gt; menuTreeVos=list.stream()</span><br><span class="line">               .map(menu -&gt; &#123;</span><br><span class="line">                   <span class="type">MenuTreeVo</span> <span class="variable">menuTreeVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MenuTreeVo</span>();</span><br><span class="line">                   menuTreeVo.setId(menu.getId());</span><br><span class="line">                   menuTreeVo.setLabel(menu.getMenuName());</span><br><span class="line">                   menuTreeVo.setParentId(menu.getParentId());</span><br><span class="line">                   <span class="keyword">return</span> menuTreeVo;</span><br><span class="line">               &#125;)</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">       List&lt;MenuTreeVo&gt; menuTreeVoList = buildMenuTree(menuTreeVos);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(menuTreeVoList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T <span class="keyword">extends</span> <span class="title class_">MenuTreeVo</span>&gt; List&lt;T&gt; <span class="title function_">buildMenuTree</span><span class="params">(List&lt;T&gt; menuList)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> menuList.stream()</span><br><span class="line">               <span class="comment">//过滤出父菜单</span></span><br><span class="line">               .filter(menuVo -&gt; Objects.equals(menuVo.getParentId(), <span class="number">0L</span>))</span><br><span class="line">               <span class="comment">//把该结点作为父结点，查找该结点的子结点并赋值</span></span><br><span class="line">               .peek(menuVo -&gt; menuVo.setChildren(getChild(menuVo.getId(), menuList)))</span><br><span class="line">               <span class="comment">//返回结果</span></span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T <span class="keyword">extends</span> <span class="title class_">MenuTreeVo</span>&gt; List&lt;T&gt; <span class="title function_">getChild</span><span class="params">(Long id, List&lt;T&gt; menuList)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> menuList.stream()</span><br><span class="line">               <span class="comment">//过滤出该父节点的子节点</span></span><br><span class="line">               .filter(menuVo -&gt; Objects.equals(menuVo.getParentId(), id))</span><br><span class="line">               <span class="comment">//把该子结点作为父结点，递归查找出该子节点的的子结点并赋值</span></span><br><span class="line">               .peek(childrenMenuVo -&gt; childrenMenuVo.setChildren(getChild(childrenMenuVo.getId(), menuList)))</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>这个树形结构的返回用到了递归下面是一些理解过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">这段代码是一个构建菜单树的方法。通过传入菜单节点列表，递归地将这些节点组织成树形结构，并返回树结构对象。</span><br><span class="line"></span><br><span class="line">首先，我们来解释treeselect()方法：</span><br><span class="line"></span><br><span class="line">获取菜单列表：</span><br><span class="line"></span><br><span class="line">List&lt;Menu&gt; list = list();</span><br><span class="line">这里使用了一个list()方法来获取菜单列表。</span><br><span class="line"></span><br><span class="line">构建MenuTreeVo对象列表：</span><br><span class="line"></span><br><span class="line">List&lt;MenuTreeVo&gt; menuTreeVos = list.stream()</span><br><span class="line">    .map(menu -&gt; &#123;</span><br><span class="line">        <span class="type">MenuTreeVo</span> <span class="variable">menuTreeVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MenuTreeVo</span>();</span><br><span class="line">        menuTreeVo.setId(menu.getId());</span><br><span class="line">        menuTreeVo.setLabel(menu.getMenuName());</span><br><span class="line">        menuTreeVo.setParentId(menu.getParentId());</span><br><span class="line">        <span class="keyword">return</span> menuTreeVo;</span><br><span class="line">    &#125;)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">通过流操作，将Menu对象映射为MenuTreeVo对象，并设置对应的属性值。这样就得到了一个MenuTreeVo对象列表menuTreeVos。</span><br><span class="line"></span><br><span class="line">构建菜单树：</span><br><span class="line"></span><br><span class="line">List&lt;MenuTreeVo&gt; menuTreeVoList = buildMenuTree(menuTreeVos);</span><br><span class="line">调用buildMenuTree()方法来构建菜单树，传入menuTreeVos作为参数，返回一个经过处理的树形结构。</span><br><span class="line"></span><br><span class="line">返回结果：</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ResponseResult.okResult(menuTreeVoList);</span><br><span class="line">将构建好的菜单树封装到ResponseResult对象中，并作为方法的返回值。</span><br><span class="line"></span><br><span class="line">接下来，我们解释buildMenuTree()方法：</span><br><span class="line"></span><br><span class="line">这个方法用于构建菜单树，接收一个菜单节点列表作为参数，并返回一棵树结构。</span><br><span class="line"></span><br><span class="line">过滤出父菜单：</span><br><span class="line"></span><br><span class="line">.filter(menuVo -&gt; Objects.equals(menuVo.getParentId(), <span class="number">0L</span>))</span><br><span class="line">使用filter()方法过滤出parentId等于<span class="number">0</span>的菜单项，即父菜单项。</span><br><span class="line"></span><br><span class="line">获取子菜单：</span><br><span class="line"></span><br><span class="line">.peek(menuVo -&gt; menuVo.setChildren(getChild(menuVo.getId(), menuList)))</span><br><span class="line">对过滤后的父菜单项进行处理，在每个父菜单项上调用getChild()方法来获取其子菜单项，并将子菜单项设置给父菜单项的children属性。</span><br><span class="line"></span><br><span class="line">返回结果：</span><br><span class="line"></span><br><span class="line">.collect(Collectors.toList());</span><br><span class="line">将构建好的菜单树返回。</span><br><span class="line"></span><br><span class="line">最后，我们解释getChild()方法：</span><br><span class="line"></span><br><span class="line">这个方法用于递归查找子菜单项。传入一个父节点id和菜单列表，返回该父节点的子菜单列表。</span><br><span class="line"></span><br><span class="line">过滤出该父节点的子节点：</span><br><span class="line"></span><br><span class="line">.filter(menuVo -&gt; Objects.equals(menuVo.getParentId(), id))</span><br><span class="line">使用filter()方法过滤出parentId等于传入的id的菜单项，即子菜单项。</span><br><span class="line"></span><br><span class="line">获取孙子菜单：</span><br><span class="line"></span><br><span class="line">.peek(childrenMenuVo -&gt; childrenMenuVo.setChildren(getChild(childrenMenuVo.getId(), menuList)))</span><br><span class="line">对过滤后的子菜单项进行处理，在每个子菜单项上调用getChild()方法来获取其孙子菜单项，并将孙子菜单项设置给子菜单项的children属性。</span><br><span class="line"></span><br><span class="line">返回结果：</span><br><span class="line"></span><br><span class="line">.collect(Collectors.toList());</span><br><span class="line">将构建好的子菜单列表返回。</span><br><span class="line"></span><br><span class="line">通过这种递归调用的方式，可以不断地查找父节点的子节点，然后对子节点进行进一步的递归查找，最终构建出完整的菜单树结构。</span><br></pre></td></tr></table></figure>



<h5 id="5-20-2-2-新增角色接口"><a href="#5-20-2-2-新增角色接口" class="headerlink" title="5.20.2.2 新增角色接口"></a>5.20.2.2 新增角色接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>system&#x2F;role</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;测试新增角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;wds&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;menuIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;100&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;我是角色备注&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>







<h3 id="5-21-修改角色"><a href="#5-21-修改角色" class="headerlink" title="5.21 修改角色"></a>5.21 修改角色</h3><h4 id="5-21-1-需求"><a href="#5-21-1-需求" class="headerlink" title="5.21.1 需求"></a>5.21.1 需求</h4><p>​	需要提供修改角色的功能。修改角色时可以修改角色所关联的菜单权限</p>
<h4 id="5-21-2-接口设计"><a href="#5-21-2-接口设计" class="headerlink" title="5.21.2 接口设计"></a>5.21.2 接口设计</h4><h5 id="5-21-2-1-角色信息回显接口"><a href="#5-21-2-1-角色信息回显接口" class="headerlink" title="5.21.2.1 角色信息回显接口"></a>5.21.2.1 角色信息回显接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>system&#x2F;role&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 角色id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘎嘎嘎&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘎嘎嘎&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="5-21-2-2-加载对应角色菜单列表树接口"><a href="#5-21-2-2-加载对应角色菜单列表树接口" class="headerlink" title="5.21.2.2 加载对应角色菜单列表树接口"></a>5.21.2.2 加载对应角色菜单列表树接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>&#x2F;system&#x2F;menu&#x2F;roleMenuTreeselect&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 角色id</p>
<p>响应格式：</p>
<p>字段介绍</p>
<p>​	menus：菜单树。</p>
<p>​	checkedKeys：角色所关联的菜单权限id列表。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;menus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">							<span class="punctuation">&#123;</span></span><br><span class="line">								<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">							</span><br><span class="line">								<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">							<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="punctuation">&#123;</span></span><br><span class="line">								<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1015&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">							<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="punctuation">&#123;</span></span><br><span class="line">								<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1016&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单删除&quot;</span><span class="punctuation">,</span></span><br><span class="line">								<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span></span><br><span class="line">							<span class="punctuation">&#125;</span></span><br><span class="line">						<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;102&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;标签管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;checkedKeys&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;1001&quot;</span>  </span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="5-21-2-3-更新角色信息接口"><a href="#5-21-2-3-更新角色信息接口" class="headerlink" title="5.21.2.3 更新角色信息接口"></a>5.21.2.3 更新角色信息接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>system&#x2F;role</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;13&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;我是角色备注&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;wds&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;测试新增角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;menuIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;100&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;1001&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">saveRole</span><span class="params">(RoleDto roleDto)</span> &#123;</span><br><span class="line">    <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> BeanCopyUtils.copyBean(roleDto, Role.class);</span><br><span class="line">    updateById(role);</span><br><span class="line">    List&lt;Long&gt; menuIds = roleDto.getMenuIds();</span><br><span class="line">    <span class="keyword">if</span> (menuIds != <span class="literal">null</span> &amp;&amp; menuIds.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        baseMapper.deleteRoleMenuByRoleId(role.getId());</span><br><span class="line">        baseMapper.insertRoleMenu(menuIds, role.getId());</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        baseMapper.deleteRoleMenuByRoleId(role.getId());</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟用户的保存一样，用户表里的数据关联的是role_id权限信息，是sys_user_role</p>
<p>这里是sys_menu_role，权限和角色的关系</p>
<h3 id="5-22-删除角色"><a href="#5-22-删除角色" class="headerlink" title="5.22 删除角色"></a>5.22 删除角色</h3><h4 id="5-22-1-需求"><a href="#5-22-1-需求" class="headerlink" title="5.22.1 需求"></a>5.22.1 需求</h4><p>​	删除固定的某个角色（逻辑删除）</p>
<h4 id="5-22-2-接口设计"><a href="#5-22-2-接口设计" class="headerlink" title="5.22.2 接口设计"></a>5.22.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>system&#x2F;role&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path请求参数：</p>
<p>id：要删除的角色id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-23-用户列表"><a href="#5-23-用户列表" class="headerlink" title="5.23 用户列表"></a>5.23 用户列表</h3><h4 id="5-23-1-需求"><a href="#5-23-1-需求" class="headerlink" title="5.23.1 需求"></a>5.23.1 需求</h4><p>​	需要用户分页列表接口。</p>
<p>​	可以根据用户名模糊搜索。</p>
<p>​	可以进行手机号的搜索。</p>
<p>​	可以进行状态的查询。</p>
<h4 id="5-23-2-接口设计"><a href="#5-23-2-接口设计" class="headerlink" title="5.23.2 接口设计"></a>5.23.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>system&#x2F;user&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>userName：用户名</p>
<p>phonenumber：手机号</p>
<p>status:状态</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://r7yxkqloa.bkt.clouddn.com/2022/03/05/75fd15587811443a9a9a771f24da458d.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-05 17:01:56&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg3334&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;phonenumber&quot;</span><span class="punctuation">:</span><span class="string">&quot;18888888888&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-03-13 21:36:22&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">userList</span><span class="params">(Integer pageNum, Integer pageSize, String roleName, String status)</span> &#123;</span><br><span class="line">     <span class="comment">//条件查询</span></span><br><span class="line">     LambdaQueryWrapper&lt;Role&gt; lqw =<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">     lqw.like(Objects.nonNull(roleName),Role::getRoleName,<span class="string">&quot;%&quot;</span>+roleName+<span class="string">&quot;%&quot;</span>)</span><br><span class="line">             .eq(Strings.isNotEmpty(status),Role::getStatus,status)</span><br><span class="line">             .orderByDesc(Role::getRoleSort);</span><br><span class="line">     <span class="comment">//分页查询</span></span><br><span class="line">     Page&lt;Role&gt; pageInfo =<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">     page(pageInfo,lqw);</span><br><span class="line">     List&lt;RoleVo&gt; roleVos = BeanCopyUtils.copyBeanList(pageInfo.getRecords(), RoleVo.class);</span><br><span class="line">     <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">PageVo</span>(roleVos,pageInfo.getTotal());</span><br><span class="line">     <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>千篇一律的东西。</p>
<h3 id="5-24-新增用户！！！"><a href="#5-24-新增用户！！！" class="headerlink" title="5.24 新增用户！！！"></a>5.24 新增用户！！！</h3><h4 id="5-24-1-需求"><a href="#5-24-1-需求" class="headerlink" title="5.24.1 需求"></a>5.24.1 需求</h4><p>​	需要新增用户功能。新增用户时可以直接关联角色。</p>
<p>​	注意：新增用户时注意密码加密存储。</p>
<p>​	用户名不能为空，否则提示：必需填写用户名</p>
<p>​	用户名必须之前未存在，否则提示：用户名已存在</p>
<p>​    手机号必须之前未存在，否则提示：手机号已存在</p>
<p>​	邮箱必须之前未存在，否则提示：邮箱已存在</p>
<h4 id="5-24-2-接口设计"><a href="#5-24-2-接口设计" class="headerlink" title="5.24.2 接口设计"></a>5.24.2 接口设计</h4><h5 id="5-24-2-1-查询角色列表接口"><a href="#5-24-2-1-查询角色列表接口" class="headerlink" title="5.24.2.1 查询角色列表接口"></a>5.24.2.1 查询角色列表接口</h5><p>注意：查询的是所有状态正常的角色</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;system&#x2F;role&#x2F;listAllRole</td>
<td>是</td>
</tr>
</tbody></table>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;common&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-02 06:32:58&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-06 22:07:40&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘎嘎嘎&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘎嘎嘎&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-09-12 10:00:25&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-16 14:49:30&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;12&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;link&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链审核员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-16 16:05:09&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;Role&gt; <span class="title function_">listAllRole</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Role&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    lqw.eq(Role::getStatus,<span class="number">0</span>);</span><br><span class="line">    List&lt;Role&gt; roles = roleMapper.selectList(lqw);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(roles);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-24-2-2-新增用户"><a href="#5-24-2-2-新增用户" class="headerlink" title="5.24.2.2 新增用户"></a>5.24.2.2 新增用户</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>system&#x2F;user</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;wqeree&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;测试新增用户&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;1234343&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phonenumber&quot;</span><span class="punctuation">:</span><span class="string">&quot;18889778907&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;233@sq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">insertUser</span><span class="params">(UserDto userDto)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (userNameExist(userDto.getUserName()))</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST) ;</span><br><span class="line">       <span class="keyword">if</span> (emailExist(userDto.getEmail()))</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_EXIST);</span><br><span class="line">       <span class="keyword">if</span> (phonenumberExist(userDto.getPhonenumber()))</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PHONENUMBER_EXIST);</span><br><span class="line">       userDto.setPassword(passwordEncoder.encode(userDto.getPassword()));</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> BeanCopyUtils.copyBean(userDto, User.class);</span><br><span class="line">       save(user);</span><br><span class="line"></span><br><span class="line">       List&lt;String&gt; roleIds = userDto.getRoleIds();</span><br><span class="line"></span><br><span class="line">       baseMapper.insertUserRole(roleIds,user.getId());</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserRole&quot;</span>&gt;</span></span><br><span class="line">    insert into `sys_user_role`(user_id,role_id)</span><br><span class="line">    values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;roleIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;roleId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;roleId&#125;,#&#123;userId&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>从新增用户的接收数据来看，一部分数据保存到user表，一部分保存到sys_user_role表，需要注意的是后面很多功能其实都不是很完善，仅仅是实现了功能，很多贴合现实逻辑的一些判断，并没有考虑到，这里的重复判断就是一个例子。判断用户名邮箱和电话是否重复，以及密码的加密处理。</p>
<h3 id="5-25-删除用户"><a href="#5-25-删除用户" class="headerlink" title="5.25 删除用户"></a>5.25 删除用户</h3><h4 id="5-25-1-需求"><a href="#5-25-1-需求" class="headerlink" title="5.25.1 需求"></a>5.25.1 需求</h4><p>删除固定的某个用户（逻辑删除）</p>
<h4 id="5-25-2-接口设计"><a href="#5-25-2-接口设计" class="headerlink" title="5.25.2 接口设计"></a>5.25.2 接口设计</h4><p>不能删除当前操作的用户</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>&#x2F;system&#x2F;user&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path请求参数：</p>
<p>id：要删除的用户id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-26-修改用户"><a href="#5-26-修改用户" class="headerlink" title="5.26 修改用户"></a>5.26 修改用户</h3><h4 id="5-26-1-需求"><a href="#5-26-1-需求" class="headerlink" title="5.26.1 需求"></a>5.26.1 需求</h4><p>需要提供修改用户的功能。修改用户时可以修改用户所关联的角色。</p>
<h4 id="5-26-2-接口设计"><a href="#5-26-2-接口设计" class="headerlink" title="5.26.2 接口设计"></a>5.26.2 接口设计</h4><h5 id="5-26-2-1-根据id查询用户信息回显接口"><a href="#5-26-2-1-根据id查询用户信息回显接口" class="headerlink" title="5.26.2.1 根据id查询用户信息回显接口"></a>5.26.2.1 根据id查询用户信息回显接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>&#x2F;system&#x2F;user&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 用户id</p>
<p>响应格式：</p>
<p>roleIds：用户所关联的角色id列表</p>
<p>roles：所有角色的列表</p>
<p>user：用户信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;roleIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;11&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;weq@2132.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;14787164048663&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg777&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg777&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>首先这个响应格式有点新奇：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateUserVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UpdateUserInfoVo user;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; roleIds;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这也就表明，要根据传入的用户id，分别查询到这三块内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;UpdateUserVo&gt; <span class="title function_">getByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//roleIds</span></span><br><span class="line">    List&lt;String&gt; roleIDs =userMapper.getRoleID(id);</span><br><span class="line">    <span class="comment">//查roles</span></span><br><span class="line">    List&lt;Role&gt; roles = roleMapper.selectBatchIds(roleIDs);</span><br><span class="line">    <span class="comment">//查user</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(id);</span><br><span class="line">    <span class="type">UpdateUserInfoVo</span> <span class="variable">updateUserInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user, UpdateUserInfoVo.class);</span><br><span class="line">    <span class="type">UpdateUserVo</span> <span class="variable">updateUserVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateUserVo</span>();</span><br><span class="line">    updateUserVo.setRoleIds(roleIDs);</span><br><span class="line">    updateUserVo.setRoles(roles);</span><br><span class="line">    updateUserVo.setUser(updateUserInfoVo);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(updateUserVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getRoleID&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">    select role_id</span><br><span class="line">    from `sys_user_role`</span><br><span class="line">    where user_id =#&#123;userId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里为啥又用到了mybatis映射文件，因为关联表sys_user_role没有创建实体类，Service层和Mapper层</p>
<p>这里的id有点问题：</p>
<p>1、案例场景<br>我们项目之中可能大多数都使用自增长id作为主键id，这样对于中小型系统来说一般没有啥问题。但是随着各种业务发展以及后续可能分库分表情况；我们有些项目或者项目之中的独立微服务可能使用的是雪花算法生成的主键id(19位)长整型的。于是最近我们在项目对接其他微服务(使用的雪花主键id)之后，在前端调用接口之后发现返回结果id被裁减了。经过组内同事定位📌Long型精度损失。具体原因下面原理部分分析。</p>
<p>2、雪花(snowflake)Id,Long id前端精度损失原因<br>本人试验以及结合网上的文章，发现一个问题，在PostMan里面请求接口能够完全正确的返回雪花算法生成的主键id，但是在Swagger或者前端接口请求 浏览器之中就会出现雪花算法精度损失问题。于是查找原因如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> JavaScript 不支持后台返回的 Long 类型，JavaScript 的 number 类型的数值范围是 -<span class="number">2</span>^<span class="number">53</span>~<span class="number">2</span>^<span class="number">53</span>（不包含边界） 所以大于 <span class="number">9007199254740991</span> 的数，进制转换会存在精度问题，而雪花ID生成的数值过大，导致 JavaScript 不能正常存储导致。</span><br><span class="line"></span><br><span class="line">同时注意：建议雪花ID在数据库中使用 bigint 来存储，而不是使用 varchar；这样可以提高这样数据库的速度，使用索引的时候少一步字符串转换成数字的操作。</span><br><span class="line"></span><br><span class="line">于是我的实际项目之中返回的雪花算法的主键id  </span><br></pre></td></tr></table></figure>

<p>JavaScript的Number最大id	9007199254740991<br>项目主键id	1511972392982179840<br>浏览器或者swagger返回	1511972392982179800<br>           于是就出现了 前端传递的id，找寻不到对应的记录问题。         </p>
<p>3、解决JavaScript Number长整型精度丢失问题<br>       解决方案1 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 使用Jackson注解，我们也可以用<span class="meta">@JsonFormat</span>做类型转换  </span><br><span class="line"></span><br><span class="line"> 在VO类中，id上添加注释</span><br><span class="line"> <span class="meta">@ApiModelProperty(name = &quot;id&quot;, value = &quot;消息id&quot;)</span></span><br><span class="line"><span class="meta">@JsonProperty(&quot;id&quot;)</span></span><br><span class="line"><span class="comment">//此句为问题关键 相当于吧Long转换为String</span></span><br><span class="line"><span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING)</span></span><br><span class="line"><span class="meta">@JSONField(serializeUsing = ToStringSerializer.class)</span></span><br><span class="line"><span class="comment">//此处标识得在序列化的时候转换为字符串</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line">     其他相关：</span><br><span class="line"><span class="meta">@JSONField(serializeUsing= ToStringSerializer.class)</span></span><br><span class="line">     这个注解是Fastjson的，旨在让系统系列化时，保留相关精度。    </span><br></pre></td></tr></table></figure>



<p>   解决方案2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写一个 JSON 配置类，将 Long 类型序列化成 JSON 的时候自动转为 String 类型</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonConfiguration</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;spring.jackson.date-format:yyyy-MM-dd HH:mm:ss&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String pattern;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Jackson2ObjectMapperBuilderCustomizer <span class="title function_">jackson2ObjectMapperBuilderCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> builder -&gt; &#123;</span><br><span class="line">        <span class="comment">// Long 会自定转换成 String</span></span><br><span class="line">        builder.serializerByType(Long.class, ToStringSerializer.instance);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、成果展现<br>5、总结<br>        在解决的问题的过程之中一定要细致分析两者的之间不同的细小差异，这样才能发现问题得蛛丝马迹。比如本问题之中发现最后Id最后两位的id字段丢失。这样才能作为解决问题得突破口。</p>
<h5 id="5-26-2-2-更新用户信息接口"><a href="#5-26-2-2-更新用户信息接口" class="headerlink" title="5.26.2.2 更新用户信息接口"></a>5.26.2.2 更新用户信息接口</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;system&#x2F;user</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;weq@2132.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;14787164048663&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg777&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg777&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roleIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;11&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> UserDto userDto)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  userService.saveUser(userDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">saveUser</span><span class="params">(UserDto userDto)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> BeanCopyUtils.copyBean(userDto, User.class);</span><br><span class="line">    updateById(user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把roleId保存进sys_user_role</span></span><br><span class="line">    List&lt;String&gt; roleIds = userDto.getRoleIds();</span><br><span class="line">    baseMapper.deleteUserRole(user.getId());</span><br><span class="line">    baseMapper.insertUserRole(roleIds, user.getId());</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserRole&quot;</span>&gt;</span></span><br><span class="line">      insert into `sys_user_role`(user_id,role_id)</span><br><span class="line">      values</span><br><span class="line">          <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;roleIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;roleId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">              (#&#123;roleId&#125;,#&#123;userId&#125;)</span><br><span class="line">          <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserRole&quot;</span>&gt;</span></span><br><span class="line">      DELETE FROM sys_user_role WHERE user_id = #&#123;userId&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>从请求参数中可以看出，涉及到两个表的字段，就分两步，首先把Dto里的User表的内容保存进User表，然后把roleIds保存到sys_user_role表中，现根据user_id删除所有role_id，然后传入新的数据。</p>
<h3 id="5-27-分页查询分类列表"><a href="#5-27-分页查询分类列表" class="headerlink" title="5.27 分页查询分类列表"></a>5.27 分页查询分类列表</h3><h4 id="5-27-1-需求"><a href="#5-27-1-需求" class="headerlink" title="5.27.1 需求"></a>5.27.1 需求</h4><p>​	需要分页查询分类列表。</p>
<p>​	能根据分类名称进行模糊查询。</p>
<p>​	能根据状态进行查询。</p>
<h4 id="5-27-2-接口设计"><a href="#5-27-2-接口设计" class="headerlink" title="5.27.2 接口设计"></a>5.27.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>content&#x2F;category&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>name：分类名</p>
<p>status: 状态</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;wsd&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;wsd&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;PHP&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-28-新增分类"><a href="#5-28-新增分类" class="headerlink" title="5.28 新增分类"></a>5.28 新增分类</h3><h4 id="5-28-1-需求"><a href="#5-28-1-需求" class="headerlink" title="5.28.1 需求"></a>5.28.1 需求</h4><p>​	需要新增分类功能</p>
<h4 id="5-28-2-接口设计"><a href="#5-28-2-接口设计" class="headerlink" title="5.28.2 接口设计"></a>5.28.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;content&#x2F;category</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;威威&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;是的&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-29-修改分类"><a href="#5-29-修改分类" class="headerlink" title="5.29 修改分类"></a>5.29 修改分类</h3><h4 id="5-29-1-需求"><a href="#5-29-1-需求" class="headerlink" title="5.29.1 需求"></a>5.29.1 需求</h4><p>​	需要提供修改分类的功能</p>
<h4 id="5-29-2-接口设计"><a href="#5-29-2-接口设计" class="headerlink" title="5.29.2 接口设计"></a>5.29.2 接口设计</h4><h5 id="5-29-2-1-根据id查询分类"><a href="#5-29-2-1-根据id查询分类" class="headerlink" title="5.29.2.1 根据id查询分类"></a>5.29.2.1 根据id查询分类</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>content&#x2F;category&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 分类id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;qwew&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;ww&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="5-29-2-2-更新分类"><a href="#5-29-2-2-更新分类" class="headerlink" title="5.29.2.2 更新分类"></a>5.29.2.2 更新分类</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;content&#x2F;category</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;是的&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;威威2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-30-删除分类"><a href="#5-30-删除分类" class="headerlink" title="5.30 删除分类"></a>5.30 删除分类</h3><h4 id="5-30-1-需求"><a href="#5-30-1-需求" class="headerlink" title="5.30.1 需求"></a>5.30.1 需求</h4><p>​	删除某个分类（逻辑删除）</p>
<h4 id="5-30-2-接口设计"><a href="#5-30-2-接口设计" class="headerlink" title="5.30.2 接口设计"></a>5.30.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>&#x2F;content&#x2F;category&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path请求参数：</p>
<p>id：要删除的分类id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-31-分页查询友链列表"><a href="#5-31-分页查询友链列表" class="headerlink" title="5.31 分页查询友链列表"></a>5.31 分页查询友链列表</h3><h4 id="5-31-1-需求"><a href="#5-31-1-需求" class="headerlink" title="5.31.1 需求"></a>5.31.1 需求</h4><p>​	需要分页查询友链列表。</p>
<p>​	能根据友链名称进行模糊查询。</p>
<p>​	能根据状态进行查询。</p>
<h4 id="5-31-2-接口设计"><a href="#5-31-2-接口设计" class="headerlink" title="5.31.2 接口设计"></a>5.31.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;content&#x2F;link&#x2F;list</td>
<td>是</td>
</tr>
</tbody></table>
<p>Query格式请求参数：</p>
<p>pageNum: 页码</p>
<p>pageSize: 每页条数</p>
<p>name：友链名</p>
<p>status:状态</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span>						       <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fn1.itc.cn%2Fimg8%2Fwb%2Frecom%2F2016%2F05%2F10%2F146286696706220328.PNG&amp;refer=http%3A%2F%2Fn1.itc.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1646205529&amp;t=f942665181eb9b0685db7a6f59d59975&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">listByPage</span><span class="params">(Integer pageNum, Integer pageSize, String name, String status)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> linkService.listByPage(pageNum,pageSize,name,status);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">listByPage</span><span class="params">(Integer pageNum, Integer pageSize, String name, String status)</span> &#123;</span><br><span class="line">    <span class="comment">//条件查询</span></span><br><span class="line">    LambdaQueryWrapper&lt;Link&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    lqw.like(Objects.nonNull(name),Link::getName,<span class="string">&quot;%&quot;</span>+name+<span class="string">&quot;%&quot;</span>)</span><br><span class="line">            .eq(Objects.nonNull(status),Link::getStatus,status);</span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Link&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">    page(pageInfo,lqw);</span><br><span class="line">    List&lt;AdminLinkVo&gt; adminLinkVo = BeanCopyUtils.copyBeanList(pageInfo.getRecords(), AdminLinkVo.class);</span><br><span class="line">    <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(adminLinkVo,pageInfo.getTotal());</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-32-新增友链"><a href="#5-32-新增友链" class="headerlink" title="5.32 新增友链"></a>5.32 新增友链</h3><h4 id="5-32-1-需求"><a href="#5-32-1-需求" class="headerlink" title="5.32.1 需求"></a>5.32.1 需求</h4><p>​	需要新增友链功能</p>
<h4 id="5-32-2-接口设计"><a href="#5-32-2-接口设计" class="headerlink" title="5.32.2 接口设计"></a>5.32.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>&#x2F;content&#x2F;link</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;weqw&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;wewe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span><span class="string">&quot;weqe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">insertLink</span><span class="params">(<span class="meta">@RequestBody</span> LinkDto linkDto)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> linkService.insertLink(linkDto);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult <span class="title function_">insertLink</span><span class="params">(LinkDto linkDto)</span> &#123;</span><br><span class="line">      <span class="type">Link</span> <span class="variable">link</span> <span class="operator">=</span> BeanCopyUtils.copyBean(linkDto, Link.class);</span><br><span class="line">      save(link);</span><br><span class="line">      <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-33-修改友链"><a href="#5-33-修改友链" class="headerlink" title="5.33 修改友链"></a>5.33 修改友链</h3><h4 id="5-33-1-需求"><a href="#5-33-1-需求" class="headerlink" title="5.33.1 需求"></a>5.33.1 需求</h4><p>​	需要提供修改友链的功能</p>
<h4 id="5-33-2-接口设计"><a href="#5-33-2-接口设计" class="headerlink" title="5.33.2 接口设计"></a>5.33.2 接口设计</h4><h5 id="5-33-2-1-根据id查询友联"><a href="#5-33-2-1-根据id查询友联" class="headerlink" title="5.33.2.1 根据id查询友联"></a>5.33.2.1 根据id查询友联</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>Get</td>
<td>content&#x2F;link&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path格式请求参数：</p>
<p>id: 友链id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;wewe&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;weqw&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span><span class="string">&quot;weqe&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult&lt;AdminLinkVo&gt; <span class="title function_">getByLinkId</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> linkService.getByLinkId(id);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;AdminLinkVo&gt; <span class="title function_">getByLinkId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Link</span> <span class="variable">byId</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="type">AdminLinkVo</span> <span class="variable">adminLinkVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(byId, AdminLinkVo.class);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(adminLinkVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>回显操作，根据ID拿到Link，然后拷贝到返回的VO类型就完了。</p>
<h5 id="5-33-2-2-修改友链"><a href="#5-33-2-2-修改友链" class="headerlink" title="5.33.2.2 修改友链"></a>5.33.2.2 修改友链</h5><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>&#x2F;content&#x2F;link</td>
<td>是</td>
</tr>
</tbody></table>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://www.qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;dada2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fn1.itc.cn%2Fimg8%2Fwb%2Frecom%2F2016%2F05%2F10%2F146286696706220328.PNG&amp;refer=http%3A%2F%2Fn1.itc.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1646205529&amp;t=f942665181eb9b0685db7a6f59d59975&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span>	</span><br></pre></td></tr></table></figure>

<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult <span class="title function_">saveCategory</span><span class="params">(<span class="meta">@RequestBody</span> LinkDto linkDto)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  linkService.saveCategory(linkDto);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult <span class="title function_">saveCategory</span><span class="params">(LinkDto linkDto)</span> &#123;</span><br><span class="line">     <span class="type">Link</span> <span class="variable">link</span> <span class="operator">=</span> BeanCopyUtils.copyBean(linkDto, Link.class);</span><br><span class="line">     updateById(link);</span><br><span class="line">     <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>需要注意从前端传过来的数据，格式用Dto对象接收，至于保存由于是单表，把数据拷给Link再保存到Link表就行</p>
<h3 id="5-34-删除友链"><a href="#5-34-删除友链" class="headerlink" title="5.34 删除友链"></a>5.34 删除友链</h3><h4 id="5-34-1-需求"><a href="#5-34-1-需求" class="headerlink" title="5.34.1 需求"></a>5.34.1 需求</h4><p>​	删除某个友链（逻辑删除）</p>
<h4 id="5-34-2-接口设计"><a href="#5-34-2-接口设计" class="headerlink" title="5.34.2 接口设计"></a>5.34.2 接口设计</h4><table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>是否需求token头</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>&#x2F;content&#x2F;link&#x2F;{id}</td>
<td>是</td>
</tr>
</tbody></table>
<p>Path请求参数：</p>
<p>id：要删除的友链id</p>
<p>响应格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult <span class="title function_">linkDelete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">      linkService.removeById(id);</span><br><span class="line">      <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>直接调用service层mybatisplus里的removeById就行了。甚至不需要去服务层 更不需要去数据层。MP的方便之处很久没体会了。（因为全是联表操作）</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://Chernoy.github.io">Chernoy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chernoy.github.io/2023/05/29/blog/">https://chernoy.github.io/2023/05/29/blog/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Chernoy.github.io" target="_blank">Chernoy’s blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://pic.peo.pw/a/2023/05/03/64520e0de0db4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" title="函数式编程"><img class="cover" src="https://pic.peo.pw/a/2023/05/29/6474795bc8d5b.png" onerror="onerror=null;src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">函数式编程</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/29/redis%E5%AE%9E%E6%88%98/" title="redis实战"><img class="cover" src="https://pic.peo.pw/a/2023/05/29/647479552c832.jpg" onerror="onerror=null;src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">redis实战</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic.peo.pw/a/2023/05/29/647490a877680.jpg" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="avatar"/></div><div class="author-info__name">Chernoy</div><div class="author-info__description">一以贯之的努力，不得懈怠的人生，每天微小的积累会决定最终的结果。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Chernoy"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Chernoy/" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="/1959613890@email.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a><a class="social-icon" href="/1959613890" target="_blank" title="QQ"><i class="fa-brands fa-qq" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Chernoy的博客，欢迎访问！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">项目实战-前后端分离博客系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1.课程介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2.创建工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8D%9A%E5%AE%A2%E5%89%8D%E5%8F%B0"><span class="toc-number">1.3.</span> <span class="toc-text">3.博客前台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-0-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.0 准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-SpringBoot%E5%92%8CMybatisPuls%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">3.1 SpringBoot和MybatisPuls整合配置测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.1 热门文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-0-%E6%96%87%E7%AB%A0%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">3.1.0 文章表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">3.1.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">3.1.2 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%9F%BA%E7%A1%80%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">3.1.3 基础版本代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E4%BD%BF%E7%94%A8VO%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">3.1.4 使用VO优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-%E5%AD%97%E9%9D%A2%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">3.1.5 字面值处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Bean%E6%8B%B7%E8%B4%9D%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%B0%81%E8%A3%85"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.2 Bean拷贝工具类封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.2查询分类列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-0%E5%88%86%E7%B1%BB%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">3.2.0分类表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">3.2.1需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">3.2.2接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">3.2.3代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E5%92%8C%E8%AF%A6%E6%83%85%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.3分页查询文章列表和详情查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1%E6%96%87%E7%AB%A0%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">3.3.1文章表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">3.3.2需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">3.3.3接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">3.3.4代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5FastJson"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">3.3.5FastJson</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E5%8F%8B%E9%93%BE%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.4友链查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1%E8%A1%A8%E5%AD%97%E6%AE%B5%E5%88%86%E6%9E%90"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">3.4.1表字段分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">3.4.2需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.6.3.</span> <span class="toc-text">3.4.3接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.6.4.</span> <span class="toc-text">3.4.4代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%EF%BC%88springsecurity%EF%BC%89"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.5登录功能实现（springsecurity）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-0-%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">3.5.0 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">3.5.1 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.3.7.3.</span> <span class="toc-text">3.5.2 表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-3-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.3.7.4.</span> <span class="toc-text">3.5.3 思路分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E6%A0%A1%E9%AA%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.7.4.1.</span> <span class="toc-text">登陆校验流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SpringSecurity%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.7.4.2.</span> <span class="toc-text">SpringSecurity完整流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.7.4.3.</span> <span class="toc-text">认证流程详解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-4%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.7.5.</span> <span class="toc-text">3.5.4登录认证代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-5-%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.7.6.</span> <span class="toc-text">3.6.5 登录校验过滤器代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-6%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86"><span class="toc-number">1.3.7.7.</span> <span class="toc-text">3.6.6认证授权失败处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6%E6%9F%A5%E8%AF%A2%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.8.</span> <span class="toc-text">3.6查询评论列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1%E8%A1%A8%E5%AD%97%E6%AE%B5%E5%88%86%E6%9E%90"><span class="toc-number">1.3.8.1.</span> <span class="toc-text">3.6.1表字段分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-2%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.8.2.</span> <span class="toc-text">3.6.2需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.8.3.</span> <span class="toc-text">3.6.3代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7%E5%8F%91%E8%A1%A8%E8%AF%84%E8%AE%BA"><span class="toc-number">1.3.9.</span> <span class="toc-text">3.7发表评论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.9.1.</span> <span class="toc-text">3.7.1需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.9.2.</span> <span class="toc-text">3.7.2接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%EF%BC%9A"><span class="toc-number">1.3.9.3.</span> <span class="toc-text">3.7.3代码实现：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E5%8F%8B%E8%81%94%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.10.</span> <span class="toc-text">3.8 友联评论列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">3.8.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">3.8.2 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.10.3.</span> <span class="toc-text">3.8.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.11.</span> <span class="toc-text">3.9 个人信息查询接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.11.1.</span> <span class="toc-text">3.9.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.11.2.</span> <span class="toc-text">3.9.2 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.11.3.</span> <span class="toc-text">3.9.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10%E5%A4%B4%E5%83%8F%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.12.</span> <span class="toc-text">3.10头像上传接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.12.1.</span> <span class="toc-text">3.10.1需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-2Oss"><span class="toc-number">1.3.12.2.</span> <span class="toc-text">3.10.2Oss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-3%E4%B8%83%E7%89%9B%E4%BA%91%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.12.3.</span> <span class="toc-text">3.10.3七牛云基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-4%E4%B8%83%E7%89%9B%E4%BA%91%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">1.3.12.4.</span> <span class="toc-text">3.10.4七牛云测试代码编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-5%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.12.5.</span> <span class="toc-text">3.10.5接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-6%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.12.6.</span> <span class="toc-text">3.10.6代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11%E6%9B%B4%E6%96%B0%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.13.</span> <span class="toc-text">3.11更新个人信息接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-1%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.13.1.</span> <span class="toc-text">3.11.1接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.13.2.</span> <span class="toc-text">3.11.2代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-12%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C"><span class="toc-number">1.3.14.</span> <span class="toc-text">3.12用户注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.14.1.</span> <span class="toc-text">3.12.1需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-2%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.14.2.</span> <span class="toc-text">3.12.2接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.14.3.</span> <span class="toc-text">3.12.3代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-13Aop%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.15.</span> <span class="toc-text">3.13Aop实现日志功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-13-1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.15.1.</span> <span class="toc-text">3.13.1需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-13-2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.15.2.</span> <span class="toc-text">3.13.2代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-14-%E6%9B%B4%E6%96%B0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0"><span class="toc-number">1.3.16.</span> <span class="toc-text">3.14 更新浏览次数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-14-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.16.1.</span> <span class="toc-text">3.14.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-14-2-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.3.16.2.</span> <span class="toc-text">3.14.2 思路分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-14-3-%E9%93%BA%E5%9E%AB%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.16.3.</span> <span class="toc-text">3.14.3 铺垫知识</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-14-3-1-%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E6%97%B6%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">1.3.16.3.1.</span> <span class="toc-text">3.14.3.1 项目启动时预处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-14-3-2-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.3.16.3.2.</span> <span class="toc-text">3.14.3.2 定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#3-14-3-2-1cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.3.16.3.2.1.</span> <span class="toc-text">3.14.3.2.1cron表达式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-14-4-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.16.4.</span> <span class="toc-text">3.14.4 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-14-5-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.16.5.</span> <span class="toc-text">3.14.5 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0%E5%9C%A8%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%8A%8A%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%B5%8F%E8%A7%88%E9%87%8F%E5%AD%98%E5%82%A8%E5%88%B0redis%E4%B8%AD"><span class="toc-number">1.3.16.5.1.</span> <span class="toc-text">①在应用启动时把博客的浏览量存储到redis中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%AF%8F%E9%9A%9410%E5%88%86%E9%92%9F%E6%8A%8ARedis%E4%B8%AD%E7%9A%84%E6%B5%8F%E8%A7%88%E9%87%8F%E6%9B%B4%E6%96%B0%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD"><span class="toc-number">1.3.16.5.2.</span> <span class="toc-text">③定时任务每隔10分钟把Redis中的浏览量更新到数据库中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3%E8%AF%BB%E5%8F%96%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E9%87%8F%E6%97%B6%E4%BB%8Eredis%E8%AF%BB%E5%8F%96"><span class="toc-number">1.3.16.5.3.</span> <span class="toc-text">④读取文章浏览量时从redis读取</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Swagger2"><span class="toc-number">1.4.</span> <span class="toc-text">4.Swagger2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Swagger"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 为什么使用Swagger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">4.3.1 引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%90%AF%E7%94%A8Swagger2"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">4.3.2 启用Swagger2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">4.3.3 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-Controller%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">4.4.1 Controller配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-1-Api-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.4.3.4.1.</span> <span class="toc-text">4.4.1 @Api 注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">4.4.2 接口配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-1-%E6%8E%A5%E5%8F%A3%E6%8F%8F%E8%BF%B0%E9%85%8D%E7%BD%AE-ApiOperation"><span class="toc-number">1.4.3.5.1.</span> <span class="toc-text">4.4.2.1 接口描述配置@ApiOperation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2-2-%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.4.3.5.2.</span> <span class="toc-text">4.4.2.2 接口参数描述</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-%E5%AE%9E%E4%BD%93%E7%B1%BB%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.6.</span> <span class="toc-text">4.4.3 实体类配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-3-1-%E5%AE%9E%E4%BD%93%E7%9A%84%E6%8F%8F%E8%BF%B0%E9%85%8D%E7%BD%AE-ApiModel"><span class="toc-number">1.4.3.6.1.</span> <span class="toc-text">4.4.3.1 实体的描述配置@ApiModel</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-3-2-%E5%AE%9E%E4%BD%93%E7%9A%84%E5%B1%9E%E6%80%A7%E7%9A%84%E6%8F%8F%E8%BF%B0%E9%85%8D%E7%BD%AE-ApiModelProperty"><span class="toc-number">1.4.3.6.2.</span> <span class="toc-text">4.4.3.2 实体的属性的描述配置@ApiModelProperty</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-4-%E6%96%87%E6%A1%A3%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.7.</span> <span class="toc-text">4.4.4 文档信息配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%8D%9A%E5%AE%A2%E5%90%8E%E5%8F%B0"><span class="toc-number">1.5.</span> <span class="toc-text">5.博客后台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-0%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.0准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-0Tag%E6%A0%87%E7%AD%BE%E5%88%97%E8%A1%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.0Tag标签列表测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.1后台登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">5.1.1 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">5.1.2 思路分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">5.1.3 准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">5.1.4 登录接口代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LoginController"><span class="toc-number">1.5.2.4.1.</span> <span class="toc-text">LoginController</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LoginService"><span class="toc-number">1.5.2.4.2.</span> <span class="toc-text">LoginService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SecurityConfig"><span class="toc-number">1.5.2.4.3.</span> <span class="toc-text">SecurityConfig</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SystemLoginServiceImpl"><span class="toc-number">1.5.2.4.4.</span> <span class="toc-text">SystemLoginServiceImpl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserDetailServiceImpl"><span class="toc-number">1.5.2.4.5.</span> <span class="toc-text">UserDetailServiceImpl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LoginUser"><span class="toc-number">1.5.2.4.6.</span> <span class="toc-text">LoginUser</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%8F%8A%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.2 后台权限控制及动态路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">功能设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">5.2.1接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getInfo%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.3.4.1.</span> <span class="toc-text">getInfo接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getInfo%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.3.4.2.</span> <span class="toc-text">getInfo接口实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Controller%E5%B1%82"><span class="toc-number">1.5.3.4.2.1.</span> <span class="toc-text">Controller层</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E6%9D%83%E9%99%90"><span class="toc-number">1.5.3.4.2.2.</span> <span class="toc-text">查权限</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.3.4.2.3.</span> <span class="toc-text">查角色</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">功能测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.3.6.</span> <span class="toc-text">5.2.2接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getRouters%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.3.6.1.</span> <span class="toc-text">getRouters接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getRouters%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.3.6.2.</span> <span class="toc-text">getRouters接口实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Controller%E5%B1%82-1"><span class="toc-number">1.5.3.6.2.1.</span> <span class="toc-text">Controller层</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MenuServiceImpl"><span class="toc-number">1.5.3.6.2.2.</span> <span class="toc-text">MenuServiceImpl</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MenuMapper-xml"><span class="toc-number">1.5.3.6.2.3.</span> <span class="toc-text">MenuMapper.xml</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.3 退出登录接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">5.3.1 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">5.3.2 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%9F%A5%E8%AF%A2%E6%A0%87%E7%AD%BE%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.4 查询标签列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-0-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">5.4.0 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E6%A0%87%E7%AD%BE%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">5.4.1 标签表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">5.4.2 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">5.4.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E6%96%B0%E5%A2%9E%E6%A0%87%E7%AD%BE"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.5 新增标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-0-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">5.5.0 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">5.5.1 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">5.5.2 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E5%88%A0%E9%99%A4%E6%A0%87%E7%AD%BE"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.6 删除标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">5.6.1 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">5.6.2 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE"><span class="toc-number">1.5.8.</span> <span class="toc-text">5.7 修改标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-1-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">5.7.1 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-7-1-1-%E8%8E%B7%E5%8F%96%E6%A0%87%E7%AD%BE%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.8.1.1.</span> <span class="toc-text">5.7.1.1 获取标签信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-7-1-2-%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.8.1.2.</span> <span class="toc-text">5.7.1.2 修改标签接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-%E5%86%99%E5%8D%9A%E6%96%87"><span class="toc-number">1.5.9.</span> <span class="toc-text">5.8 写博文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.9.1.</span> <span class="toc-text">5.8.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-2-%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.5.9.2.</span> <span class="toc-text">5.8.2 表分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.9.3.</span> <span class="toc-text">5.8.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-2-1-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.3.1.</span> <span class="toc-text">5.8.2.1 查询所有分类接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-2-2-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%A0%87%E7%AD%BE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.3.2.</span> <span class="toc-text">5.8.2.2 查询所有标签接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-2-3-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87"><span class="toc-number">1.5.9.3.3.</span> <span class="toc-text">5.8.2.3 上传图片</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-2-4-%E6%96%B0%E5%A2%9E%E5%8D%9A%E6%96%87"><span class="toc-number">1.5.9.3.4.</span> <span class="toc-text">5.8.2.4 新增博文</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.9.4.</span> <span class="toc-text">5.8.3 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-3-1-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.4.1.</span> <span class="toc-text">5.8.3.1 查询所有分类接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-3-2-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%A0%87%E7%AD%BE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.4.2.</span> <span class="toc-text">5.8.3.2 查询所有标签接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-3-3-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.4.3.</span> <span class="toc-text">5.8.3.3 上传图片接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-3-4-%E6%96%B0%E5%A2%9E%E5%8D%9A%E6%96%87%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.9.4.4.</span> <span class="toc-text">5.8.3.4 新增博文接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-%E5%AF%BC%E5%87%BA%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB%E5%88%B0Excel"><span class="toc-number">1.5.10.</span> <span class="toc-text">5.9 导出所有分类到Excel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-9-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.10.1.</span> <span class="toc-text">5.9.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-9-2-%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88"><span class="toc-number">1.5.10.2.</span> <span class="toc-text">5.9.2 技术方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-9-3-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.10.3.</span> <span class="toc-text">5.9.3 接口设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-9-4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.10.4.</span> <span class="toc-text">5.9.4 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">1.5.11.</span> <span class="toc-text">5.10 权限控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-10-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.11.1.</span> <span class="toc-text">5.10.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-10-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.11.2.</span> <span class="toc-text">5.10.2 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-11-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.12.</span> <span class="toc-text">5.11 文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-10-1-%E9%9C%80%E6%B1%82-1"><span class="toc-number">1.5.12.1.</span> <span class="toc-text">5.10.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-10-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.12.2.</span> <span class="toc-text">5.10.2  接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-12-%E4%BF%AE%E6%94%B9%E6%96%87%E7%AB%A0"><span class="toc-number">1.5.13.</span> <span class="toc-text">5.12 修改文章</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-12-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.13.1.</span> <span class="toc-text">5.12.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-12-2-%E5%88%86%E6%9E%90"><span class="toc-number">1.5.13.2.</span> <span class="toc-text">5.12.2 分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-12-3-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.13.3.</span> <span class="toc-text">5.12.3 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-12-3-1-%E6%9F%A5%E8%AF%A2%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.13.3.1.</span> <span class="toc-text">5.12.3.1 查询文章详情接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-12-3-2-%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.13.3.2.</span> <span class="toc-text">5.12.3.2 更新文章接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-13-%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0"><span class="toc-number">1.5.14.</span> <span class="toc-text">5.13 删除文章</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-13-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.14.1.</span> <span class="toc-text">5.13.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-13-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.14.2.</span> <span class="toc-text">5.13.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-14-%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.15.</span> <span class="toc-text">5.14 菜单列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-14-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.15.1.</span> <span class="toc-text">5.14.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-14-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.15.2.</span> <span class="toc-text">5.14.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-15-%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%8D%95"><span class="toc-number">1.5.16.</span> <span class="toc-text">5.15 新增菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-15-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.16.1.</span> <span class="toc-text">5.15.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-15-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.16.2.</span> <span class="toc-text">5.15.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-16-%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%8D%95"><span class="toc-number">1.5.17.</span> <span class="toc-text">5.16 修改菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-16-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.17.1.</span> <span class="toc-text">5.16.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-16-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.17.2.</span> <span class="toc-text">5.16.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-16-2-1-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.17.2.1.</span> <span class="toc-text">5.16.2.1 根据id查询菜单数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-16-2-2-%E6%9B%B4%E6%96%B0%E8%8F%9C%E5%8D%95"><span class="toc-number">1.5.17.2.2.</span> <span class="toc-text">5.16.2.2 更新菜单</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-17-%E5%88%A0%E9%99%A4%E8%8F%9C%E5%8D%95"><span class="toc-number">1.5.18.</span> <span class="toc-text">5.17 删除菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-17-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.18.1.</span> <span class="toc-text">5.17.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-17-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.18.2.</span> <span class="toc-text">5.17.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-18-%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.19.</span> <span class="toc-text">5.18 角色列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-18-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.19.1.</span> <span class="toc-text">5.18.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-18-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.19.2.</span> <span class="toc-text">5.18.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-19-%E6%94%B9%E5%8F%98%E8%A7%92%E8%89%B2%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.20.</span> <span class="toc-text">5.19 改变角色状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-19-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.20.1.</span> <span class="toc-text">5.19.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-19-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.20.2.</span> <span class="toc-text">5.19.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-20-%E6%96%B0%E5%A2%9E%E8%A7%92%E8%89%B2%EF%BC%81%EF%BC%81"><span class="toc-number">1.5.21.</span> <span class="toc-text">5.20 新增角色！！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-20-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.21.1.</span> <span class="toc-text">5.20.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-20-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.21.2.</span> <span class="toc-text">5.20.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-20-2-1-%E8%8E%B7%E5%8F%96%E8%8F%9C%E5%8D%95%E6%A0%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.21.2.1.</span> <span class="toc-text">5.20.2.1 获取菜单树接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-20-2-2-%E6%96%B0%E5%A2%9E%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.21.2.2.</span> <span class="toc-text">5.20.2.2 新增角色接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-21-%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.22.</span> <span class="toc-text">5.21 修改角色</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-21-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.22.1.</span> <span class="toc-text">5.21.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-21-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.22.2.</span> <span class="toc-text">5.21.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-21-2-1-%E8%A7%92%E8%89%B2%E4%BF%A1%E6%81%AF%E5%9B%9E%E6%98%BE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.22.2.1.</span> <span class="toc-text">5.21.2.1 角色信息回显接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-21-2-2-%E5%8A%A0%E8%BD%BD%E5%AF%B9%E5%BA%94%E8%A7%92%E8%89%B2%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8%E6%A0%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.22.2.2.</span> <span class="toc-text">5.21.2.2 加载对应角色菜单列表树接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-21-2-3-%E6%9B%B4%E6%96%B0%E8%A7%92%E8%89%B2%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.22.2.3.</span> <span class="toc-text">5.21.2.3 更新角色信息接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-22-%E5%88%A0%E9%99%A4%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.23.</span> <span class="toc-text">5.22 删除角色</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-22-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.23.1.</span> <span class="toc-text">5.22.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-22-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.23.2.</span> <span class="toc-text">5.22.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-23-%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.24.</span> <span class="toc-text">5.23 用户列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-23-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.24.1.</span> <span class="toc-text">5.23.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-23-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.24.2.</span> <span class="toc-text">5.23.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-24-%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7%EF%BC%81%EF%BC%81%EF%BC%81"><span class="toc-number">1.5.25.</span> <span class="toc-text">5.24 新增用户！！！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-24-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.25.1.</span> <span class="toc-text">5.24.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-24-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.25.2.</span> <span class="toc-text">5.24.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-24-2-1-%E6%9F%A5%E8%AF%A2%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.25.2.1.</span> <span class="toc-text">5.24.2.1 查询角色列表接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-24-2-2-%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.25.2.2.</span> <span class="toc-text">5.24.2.2 新增用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-25-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.26.</span> <span class="toc-text">5.25 删除用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-25-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.26.1.</span> <span class="toc-text">5.25.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-25-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.26.2.</span> <span class="toc-text">5.25.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-26-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.27.</span> <span class="toc-text">5.26 修改用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-26-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.27.1.</span> <span class="toc-text">5.26.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-26-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.27.2.</span> <span class="toc-text">5.26.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-26-2-1-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%9B%9E%E6%98%BE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.27.2.1.</span> <span class="toc-text">5.26.2.1 根据id查询用户信息回显接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-26-2-2-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.27.2.2.</span> <span class="toc-text">5.26.2.2 更新用户信息接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-27-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.28.</span> <span class="toc-text">5.27 分页查询分类列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-27-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.28.1.</span> <span class="toc-text">5.27.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-27-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.28.2.</span> <span class="toc-text">5.27.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-28-%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.29.</span> <span class="toc-text">5.28 新增分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-28-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.29.1.</span> <span class="toc-text">5.28.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-28-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.29.2.</span> <span class="toc-text">5.28.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-29-%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.30.</span> <span class="toc-text">5.29 修改分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-29-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.30.1.</span> <span class="toc-text">5.29.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-29-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.30.2.</span> <span class="toc-text">5.29.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-29-2-1-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.30.2.1.</span> <span class="toc-text">5.29.2.1 根据id查询分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-29-2-2-%E6%9B%B4%E6%96%B0%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.30.2.2.</span> <span class="toc-text">5.29.2.2 更新分类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-30-%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.31.</span> <span class="toc-text">5.30 删除分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-30-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.31.1.</span> <span class="toc-text">5.30.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-30-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.31.2.</span> <span class="toc-text">5.30.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-31-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%8F%8B%E9%93%BE%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.32.</span> <span class="toc-text">5.31 分页查询友链列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-31-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.32.1.</span> <span class="toc-text">5.31.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-31-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.32.2.</span> <span class="toc-text">5.31.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-32-%E6%96%B0%E5%A2%9E%E5%8F%8B%E9%93%BE"><span class="toc-number">1.5.33.</span> <span class="toc-text">5.32 新增友链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-32-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.33.1.</span> <span class="toc-text">5.32.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-32-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.33.2.</span> <span class="toc-text">5.32.2 接口设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-33-%E4%BF%AE%E6%94%B9%E5%8F%8B%E9%93%BE"><span class="toc-number">1.5.34.</span> <span class="toc-text">5.33 修改友链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-33-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.34.1.</span> <span class="toc-text">5.33.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-33-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.34.2.</span> <span class="toc-text">5.33.2 接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-33-2-1-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%8F%8B%E8%81%94"><span class="toc-number">1.5.34.2.1.</span> <span class="toc-text">5.33.2.1 根据id查询友联</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-33-2-2-%E4%BF%AE%E6%94%B9%E5%8F%8B%E9%93%BE"><span class="toc-number">1.5.34.2.2.</span> <span class="toc-text">5.33.2.2 修改友链</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-34-%E5%88%A0%E9%99%A4%E5%8F%8B%E9%93%BE"><span class="toc-number">1.5.35.</span> <span class="toc-text">5.34 删除友链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-34-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.5.35.1.</span> <span class="toc-text">5.34.1 需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-34-2-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.35.2.</span> <span class="toc-text">5.34.2 接口设计</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/25/mybatisplus%E7%9A%84CRUD%E6%96%B9%E6%B3%95/" title="mybatisplus的CRUD方法"><img src="https://pic.peo.pw/a/2023/04/27/644a41a2bc220.jpg" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="mybatisplus的CRUD方法"/></a><div class="content"><a class="title" href="/2023/06/25/mybatisplus%E7%9A%84CRUD%E6%96%B9%E6%B3%95/" title="mybatisplus的CRUD方法">mybatisplus的CRUD方法</a><time datetime="2023-06-25T07:10:11.000Z" title="发表于 2023-06-25 15:10:11">2023-06-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/01/SpringSecurity-JWT/" title="SpringSecurity+JWT"><img src="https://pic.peo.pw/a/2023/05/03/6451b1ab8a50b.jpg" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="SpringSecurity+JWT"/></a><div class="content"><a class="title" href="/2023/06/01/SpringSecurity-JWT/" title="SpringSecurity+JWT">SpringSecurity+JWT</a><time datetime="2023-06-01T02:15:19.000Z" title="发表于 2023-06-01 10:15:19">2023-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" title="函数式编程"><img src="https://pic.peo.pw/a/2023/05/29/6474795bc8d5b.png" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="函数式编程"/></a><div class="content"><a class="title" href="/2023/05/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" title="函数式编程">函数式编程</a><time datetime="2023-05-30T23:23:17.000Z" title="发表于 2023-05-31 07:23:17">2023-05-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/blog/" title="blog"><img src="https://pic.peo.pw/a/2023/05/03/64520e0de0db4.jpg" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="blog"/></a><div class="content"><a class="title" href="/2023/05/29/blog/" title="blog">blog</a><time datetime="2023-05-29T10:15:35.000Z" title="发表于 2023-05-29 18:15:35">2023-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/redis%E5%AE%9E%E6%88%98/" title="redis实战"><img src="https://pic.peo.pw/a/2023/05/29/647479552c832.jpg" onerror="this.onerror=null;this.src='https://pic.peo.pw/a/2023/05/03/6451b1aa04eef.jpg'" alt="redis实战"/></a><div class="content"><a class="title" href="/2023/05/29/redis%E5%AE%9E%E6%88%98/" title="redis实战">redis实战</a><time datetime="2023-05-29T01:52:29.000Z" title="发表于 2023-05-29 09:52:29">2023-05-29</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Chernoy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎光顾Chernoy的博客!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'k2BY9q06vuF7P54lwGRWbtC7-gzGzoHsz',
      appKey: 'KVskSoDG7ONXzmpG8cz9XHJY',
      avatar: 'monsterid',
      serverURLs: 'https://k2by9q06.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="1688591678" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="白银,御行,绝不,告白" data-fontsize="20px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/essay/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":200,"height":380,"hOffset":0,"vOffset":-50},"mobile":{"show":true},"react":{"opacity":0.85},"log":false});</script></body></html>